/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/test/_OpaLogger","sap/ui/test/_ParameterValidator","sap/ui/test/autowaiter/_autoWaiter","sap/ui/test/autowaiter/_autoWaiterLogCollector","sap/ui/test/autowaiter/_timeoutWaiter","sap/ui/test/autowaiter/_promiseWaiter"],function($,_,a,b,c,d,e){"use strict";var l=_.getLogger("sap.ui.test.autowaiter._autoWaiterAsync");var C=new a({errorPrefix:"sap.ui.test.autowaiter._autoWaiterAsync#extendConfig"});var w;var L;var f={interval:400,timeout:15};function g(o){v(o);$.extend(f,o);if(o.timeoutWaiter){d.extendConfig(o.timeoutWaiter);var m=o.timeoutWaiter.maxDelay;if(m){e.extendConfig({maxDelay:m});}}}function h(i){if(w){n({error:"waitAsync is already running and cannot be called again at this moment"});return;}var p=Date.now();w=true;l.debug("Start polling to check for pending asynchronous work");c.start();j();function j(){var k=(Date.now()-p)/1000;if(k<=f.timeout){if(!b.hasToWait()){n({log:"Polling finished successfully. There is no more pending asynchronous work for the moment"});w=false;}else{L=c.getAndClearLog();setTimeout(j,f.interval);}}else{n({error:"Polling stopped because the timeout of "+f.timeout+" seconds has been reached but there is still pending asynchronous work.\n"+"This is the last log of pending work:\n"+L});w=false;}}function n(r){if(i){i(r.error);}l.debug(r.error||r.log);c.stop();}}function v(o){C.validate({inputToValidate:o,validationInfo:{interval:"numeric",timeout:"numeric",timeoutWaiter:"object"}});if(o.timeout<=0||o.interval<=0){throw new Error("Invalid polling config: Timeout and interval should be greater than 0");}}return{extendConfig:g,waitAsync:h};},true);
