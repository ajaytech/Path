/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
(function(g){"use strict";var o;if(g.module){o=g.module;g.module=undefined;}sap.ui.define(['jquery.sap.global','sap/ui/core/routing/HashChanger','sap/ui/base/Object','sap/ui/core/mvc/View','./matchers/Ancestor','./matchers/Interactable','./matchers/Visible','./pipelines/MatcherPipeline','./autowaiter/_autoWaiter','sap/ui/test/_opaCorePlugin','sap/ui/test/_OpaLogger'],function($,H,U,V,A,I,a,M,_,b,c){var m=new M(),i=new I(),v=new a(),C=["id","viewName","controlType","searchOpenDialogs"];var O=U.extend("sap.ui.test.OpaPlugin",{constructor:function(){this._oLogger=c.getLogger("sap.ui.test.Opa5");},getAllControls:function(f){return b.getAllControls(f);},getView:function(s){var d=this.getAllControls(V);return d.filter(function(e){return e.getViewName()===s;})[0];},getControlInView:function(d){var s=((d.viewNamespace||"")+"."+(d.viewName||"")).replace(/\.+/g,'.').replace(/^\.|\.$/g,""),e=this.getView(s),r=[],f,h=typeof d.id==="string",j;if(!e){this._oLogger.debug("Found no view with the name: '"+s+"'");if(h){return null;}return[];}if($.isArray(d.id)){$.each(d.id,function(l,n){f=e.byId(n);if(f){r.push(f);}});return r;}if(h){var E=e.byId(d.id);if(!E){this._oLogger.debug("Found no control with the id: '"+d.id+"' in the view: '"+s+"'");return null;}return E;}var k=this.getAllControlsWithTheParent(e,d.controlType);if($.type(d.id)==="regexp"){j=e.getId();k=k.filter(function(f){var u=f.getId().replace(j,"");return d.id.test(u);});}return k;},getAllControlsWithTheParent:function(p,f){var d=new A(p);return this._filterUniqueControlsByCondition(this.getAllControls(f),d);},getAllControlsInContainer:function(d,f){return this._filterUniqueControlsByCondition(d.find("*").control(),function(e){return b.checkControlType(e,f);});},getMatchingControls:function(d){var r=null;d=d||{};var h=this._modifyControlType(d);if(!h){return typeof d.id==="string"?r:[];}if(d.searchOpenDialogs){r=this.getAllControlsInContainer($("#sap-ui-static"),d.controlType);}else if(d.viewName){r=this.getControlInView(d);}else if(d.id){r=this.getControlByGlobalId(d);}else if(d.controlType){r=this.getAllControls(d.controlType);}else{r=this.getAllControls();}if(!r||d.visible===false){return r;}var e=[];if(d.interactable){e.push(i);}else{e.push(v);}var p=m.process({control:r,matchers:e});if(!p){if($.isArray(r)){return[];}if(r){return null;}return r;}return p;},getFilterdControls:function(d){var p=$.extend({},d,{interactable:!!d.actions||d.autoWait}),P=this._isLookingForAControl(p);var e=null,r=null;if(P){e=this.getMatchingControls(p);}else if(d.autoWait&&_.hasToWait()){return O.FILTER_FOUND_NO_CONTROLS;}if(typeof d.id==="string"&&!e){return O.FILTER_FOUND_NO_CONTROLS;}if(!d.id&&(d.viewName||d.searchOpenDialogs)&&e.length===0){this._oLogger.debug("found no controls in view: "+d.viewName+" with controlType "+d.sOriginalControlType,"","Opa");return O.FILTER_FOUND_NO_CONTROLS;}if($.type(d.id)==="regexp"&&!e.length){this._oLogger.debug("found no control with the id regex"+d.id);return O.FILTER_FOUND_NO_CONTROLS;}if($.isArray(d.id)&&(!e||e.length!==d.id.length)){if(e&&e.length){this._oLogger.debug("found not all controls with the ids "+d.id+" onlyFound the controls: "+e.map(function(f){return f.sId;}));}else{this._oLogger.debug("found no control with the id  "+d.id);}return O.FILTER_FOUND_NO_CONTROLS;}if(d.controlType&&$.isArray(e)&&!e.length){this._oLogger.debug("found no controls with the type  "+d.sOriginalControlType,"","Opa");return O.FILTER_FOUND_NO_CONTROLS;}if((e||!P)&&d.matchers){r=m.process({matchers:d.matchers,control:e});if(!r){return O.FILTER_FOUND_NO_CONTROLS;}}else{r=e;}return r;},getControlByGlobalId:function(d){var s=d.id,e=[],f=[],h=b.getCoreElements();if(typeof s==="string"){e=h[s];if(!e){this._oLogger.debug("Found no control with the global id: '"+s+"'");return null;}if(!b.checkControlType(e,d.controlType)){this._oLogger.error("An id: '"+d.id+"' was passed together with the controlType '"+d.sOriginalControlType+"' but the type does not match the control retrieved: '"+e+"' - null is returned");return null;}return e;}if($.type(s)==="regexp"){for(var p in h){if(!h.hasOwnProperty(p)){continue;}if(!s.test(p)){continue;}f.push(p);}}else if($.isArray(s)){f=s;}return f.map(function(j){return h[j];}).filter(function(j){return b.checkControlType(j,d.controlType)&&j&&!j.bIsDestroyed;});},getControlConstructor:function(s){if(sap.ui.lazyRequire._isStub(s)){this._oLogger.debug("The control type "+s+" is currently a lazy stub.");return null;}var f=$.sap.getObject(s);if(!f){this._oLogger.debug("The control type "+s+" is undefined.");return null;}return f;},_isLookingForAControl:function(d){return Object.keys(d).some(function(k){return C.indexOf(k)!==-1&&!!d[k];});},_filterUniqueControlsByCondition:function(d,f){return d.filter(function(e,p,h){var k=!!f(e);return k&&h.indexOf(e)===p;});},_modifyControlType:function(d){var e=d.controlType;if(typeof e!=="string"){if(e&&e._sapUiLazyLoader){this._oLogger.debug("The control type is currently a lazy stub");return false;}return true;}var f=this.getControlConstructor(e);if(!f){return false;}d.sOriginalControlType=e;d.controlType=f;return true;}});O.FILTER_FOUND_NO_CONTROLS="FILTER_FOUND_NO_CONTROL";return O;},true);if(o){g.module=o;}})(window);
