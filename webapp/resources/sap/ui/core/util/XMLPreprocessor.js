/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/base/BindingParser','sap/ui/base/ManagedObject','sap/ui/core/XMLTemplateProcessor','sap/ui/model/BindingMode','sap/ui/model/CompositeBinding','sap/ui/model/Context'],function(q,B,M,X,a,C,b){'use strict';var u={},N="http://schemas.sap.com/sapui5/extension/sap.ui.core.template/1",x="sap.ui.core.util.XMLPreprocessor",p=[x],P=x+"/insertFragment",s=x+"/getResolvedBinding",c=x+".process",t=Object.prototype.toString,v={},W=M.extend("sap.ui.core.util._with",{metadata:{properties:{any:"any"},aggregations:{child:{multiple:false,type:"sap.ui.core.util._with"}}}}),R=W.extend("sap.ui.core.util._repeat",{metadata:{aggregations:{list:{multiple:true,type:"n/a",_doesNotRequireFactory:true}}},updateList:function(){}});function d(w,S,i,j){function k(n){if(!j){j=w.getBinding("any");if(j instanceof C){j=j.getBindings();if(i!==undefined){j=j[i];}}}return Array.isArray(j)?j[n]:j;}function m(o){return o instanceof b?o.getPath():o.getModel().resolve(o.getPath(),o.getContext());}return{getInterface:function(n,o){var y,z,A;if(typeof n==="string"){o=n;n=undefined;}k();if(Array.isArray(j)){if(n>=0&&n<j.length){z=j[n];}else{throw new Error("Invalid index of part: "+n);}}else if(n!==undefined){throw new Error("Not the root formatter of a composite binding");}else if(o){z=j;}else{throw new Error("Missing path");}if(o){A=z.getModel();if(o.charAt(0)!=='/'){y=z instanceof b?z:A.createBindingContext(z.getPath(),z.getContext());}z=A.createBindingContext(o,y);if(!z){throw new Error("Model could not create binding context synchronously: "+A);}}return d(null,S,undefined,z);},getModel:function(n){var o=k(n);return o&&o.getModel();},getPath:function(n){var o=k(n);return o&&m(o);},getSetting:function(n){if(n==="bindingContexts"||n==="models"){throw new Error("Illegal argument: "+n);}return S[n];}};}function g(w,o,S,j){function k(I,i){var F=I.formatter;I.mode=a.OneTime;if(F&&F.requiresIContext===true){I.formatter=F.bind(null,d(w,S,i));}I.parameters=I.parameters||{};I.parameters.scope=j;}try{k(o);if(o.parts){o.parts.forEach(k);}w.bindProperty("any",o);return w.getBinding("any")?w.getAny():u;}finally{w.unbindProperty("any",true);}}function e(E,L){return E.namespaceURI===N&&l(E)===L;}function l(E){return E.localName||E.baseName;}function r(E){var m=E.getAttribute("template:require");if(m){q.sap.require.apply(q.sap,m.split(" "));}}function f(E){var A,o=E.attributes,T="<"+E.nodeName,i,n;for(i=0,n=o.length;i<n;i+=1){A=o.item(i);T+=" "+A.name+'="'+A.value+'"';}return T+(E.childNodes.length?">":"/>");}function h(E,i){i.visitNode(E);}return{plugIn:function(V,n,L){var o=v[n];if(V!==null&&typeof V!=="function"||V===h){throw new Error("Invalid visitor: "+V);}if(!n||n===N||n==="sap.ui.core"||n.indexOf(" ")>=0){throw new Error("Invalid namespace: "+n);}q.sap.log.debug("Plug-in visitor for namespace '"+n+"', local name '"+L+"'",V,x);if(L){n=n+" "+L;o=v[n]||o;}v[n]=V;return o||h;},visitNodeWrapper:h,process:function(o,V,S){var j=V.caller,D=q.sap.log.isLoggable(q.sap.log.Level.DEBUG,x),k=D,m=V.name,F={},w,y=0,z={},A=V._supportInfo,E=q.sap.log.isLoggable(q.sap.log.Level.WARNING,x);function G(i){return{getContext:function(n){var j1,k1,l1;n=n||"";if(n[0]==="{"){throw new Error("Must be a simple path, not a binding: "+n);}j1=B.simpleParser("{"+n+"}");k1=i.getModel(j1.model);if(!k1){throw new Error("Unknown model '"+j1.model+"': "+n);}l1=k1.resolve(j1.path,i.getBindingContext(j1.model));if(!l1){throw new Error("Cannot resolve path: "+n);}return k1.createBindingContext(l1);},getResult:function(n,j1){var k1=Q(n,j1,i,true);if(k1===u){throw new Error("Binding not ready: "+n);}return k1;},getSettings:function(){return S;},getViewInfo:function(){return q.extend(true,{},V);},insertFragment:function(n,j1){T(n,j1,i);},visitAttribute:function(n,j1){e1(n,j1,i);},visitAttributes:function(n){f1(n,i);},visitChildNodes:function(n){g1(n,i);},visitNode:function(n){h1(n,i);},"with":function(n,j1){var k1,l1=false,w,m1=new W();if(!j1){i.setChild(m1);}for(w in n){k1=n[w];l1=true;m1.setModel(k1.getModel(),w);m1.bindObject({model:w,path:k1.getPath()});}return l1||j1?G(m1):this;}};}function H(i){if(D){q.sap.log.debug(L()+Array.prototype.slice.call(arguments,1).join(" "),i&&f(i),x);}}function I(i){if(D){q.sap.log.debug(L()+"Finished","</"+i.nodeName+">",x);}}function J(i,n){i=i+f(n);q.sap.log.error(i,j,x);throw new Error(j+": "+i);}function K(j1){var k1=j1.childNodes,l1,m1=[],i,n,n1=false;for(i=0,n=k1.length;i<n;i+=1){l1=k1.item(i);if(l1.nodeType===1){m1.push(l1);}}if(!m1.length||!e(m1[0],"then")){return null;}for(i=1,n=m1.length;i<n;i+=1){l1=m1[i];if(n1){J("Expected </"+j1.prefix+":if>, but instead saw ",l1);}if(e(l1,"else")){n1=true;}else if(!e(l1,"elseif")){J("Expected <"+j1.prefix+":elseif> or <"+j1.prefix+":else>, but instead saw ",m1[i]);}}return m1;}function L(){return(y<10?"[ ":"[")+y+"] ";}function O(w){return w&&w.charAt(0)==="."?q.sap.getObject(w.slice(1),undefined,z):q.sap.getObject(w);}function Q(i,n,j1,k1,l1){var m1;q.sap.measure.average(s,"",p);m1=B.complexParser(i,z,k1,true,true)||i;if(m1.functionsNotFound){if(k1){i1(n,'Function name(s)',m1.functionsNotFound.join(", "),'not found');}q.sap.measure.end(s);return u;}if(typeof m1==="object"){m1=g(j1,m1,S,z);if(k1&&m1===u){i1(n,'Binding not ready');}}else if(l1){l1();}q.sap.measure.end(s);return m1;}function T(i,n,j1){var k1,l1=m;j1.$mFragmentContexts=j1.$mFragmentContexts||{};if(j1.$mFragmentContexts[i]){J("Cyclic reference to fragment '"+i+"' ",n);}y++;H(n,"fragmentName =",i);j1.$mFragmentContexts[i]=true;m=i;q.sap.measure.average(P,"",p);k1=F[i];if(!k1){k1=X.loadTemplate(i,"fragment");F[i]=k1;}k1=n.ownerDocument.importNode(k1,true);q.sap.measure.end(P);r(k1);if(k1.namespaceURI==="sap.ui.core"&&l(k1)==="FragmentDefinition"){U(k1,j1,n);}else{n.parentNode.insertBefore(k1,n);h1(k1,j1);}n.parentNode.removeChild(n);m=l1;j1.$mFragmentContexts[i]=false;I(n);y--;}function U(i,n,j1){var k1;j1=j1||i;g1(i,n);while((k1=i.firstChild)){j1.parentNode.insertBefore(k1,j1);}}function Y(i,n){var j1=i1.bind(null,i,'Constant test condition'),k1,l1=i.getAttribute("test"),m1;try{m1=Q(l1,i,n,true,j1);if(m1===u){m1=false;}}catch(ex){i1(i,'Error in formatter:',ex);m1=undefined;}k1=!!m1&&m1!=="false";if(D){if(typeof m1==="string"){m1=JSON.stringify(m1);}else if(m1===undefined){m1="undefined";}else if(Array.isArray(m1)){m1="[object Array]";}H(i,"test ==",m1,"-->",k1);}return k1;}function Z(i,n,j1){var k1=n.value,l1;try{l1=Q(k1,i,j1,false);if(l1===u){H(i,'Binding not ready for attribute',n.name);}else if(l1===undefined){H(i,"Removed attribute",n.name);i.removeAttribute(n.name);}else if(l1!==n.value){switch(typeof l1){case"boolean":case"number":case"string":H(i,n.name,"=",l1);n.value=l1;break;default:H(i,"Ignoring",t.call(l1),"value for attribute",n.name);}}}catch(ex){H(i,"Error in formatter of attribute",n.name,ex);}}function $(i,n){var w=i.getAttribute("name"),j1,k1,l1=i.getAttribute("value");if(!w||w.length<=1||w.lastIndexOf(".")!==0){J("Missing proper relative name in ",i);}w=w.slice(1);j1=O(l1);if(!j1){J("Invalid value in ",i);}k1=z[w];z[w]=j1;U(i,n);i.parentNode.removeChild(i);z[w]=k1;}function _(i,n){var w=i.getAttribute("name"),j1=u,k1;try{j1=Q(w,i,n,true);if(j1!==u&&j1!==w){H(i,"name =",j1);}}catch(ex){i1(i,'Error in formatter:',ex);}var m1=sap.ui.require("sap/ui/core/CustomizingConfiguration");if(j1!==u&&m1){k1=m1.getViewExtension(m,j1,V.componentId);if(k1&&k1.className==="sap.ui.core.Fragment"&&k1.type==="XML"){T(k1.fragmentName,i,n);return true;}}return false;}function a1(i,n){var j1=i.getAttribute("fragmentName"),k1;try{k1=Q(j1,i,n,true);}catch(ex){i1(i,'Error in formatter:',ex);return;}if(k1!==u){T(k1,i,n);}}function b1(i,n){var j1=K(i),k1,l1;y++;if(j1){l1=i;k1=j1.shift();do{if(Y(l1,n)){break;}l1=k1=j1.shift();}while(l1&&l(l1)==="elseif");}else if(Y(i,n)){k1=i;}if(k1){U(k1,n,i);}i.parentNode.removeChild(i);I(i);y--;}function c1(n,j1){var k1=n.getAttribute("list")||"",l1=B.complexParser(k1,z,false,true,true),m1,n1,o1,p1,q1=n.getAttribute("var");if(q1===""){J("Missing variable name for ",n);}if(!l1){J("Missing binding for ",n);}if(l1.functionsNotFound){i1(n,'Function name(s)',l1.functionsNotFound.join(", "),'not found');}p1=new R();j1.setChild(p1);l1.mode=a.OneTime;p1.bindAggregation("list",l1);n1=p1.getBinding("list");p1.unbindAggregation("list",true);o1=l1.model;if(!n1){J("Missing model '"+o1+"' in ",n);}m1=n1.getContexts(l1.startIndex,l1.length);q1=q1||o1;p1.setModel(n1.getModel(),q1);y++;H(n,"Starting");m1.forEach(function(r1,i){var s1=(i===m1.length-1)?n:n.cloneNode(true);p1.setBindingContext(r1,q1);H(n,q1,"=",r1.getPath());U(s1,p1,n);});I(n);y--;n.parentNode.removeChild(n);}function d1(i,n){var j1,k1,l1,m1,n1=i.getAttribute("helper"),o1,p1=i.getAttribute("path"),q1,r1=i.getAttribute("var");if(r1===""){J("Missing variable name for ",i);}l1=new W();n.setChild(l1);j1=B.simpleParser("{"+p1+"}");r1=r1||j1.model;if(n1||r1){k1=n.getModel(j1.model);if(!k1){J("Missing model '"+j1.model+"' in ",i);}q1=k1.resolve(j1.path,n.getBindingContext(j1.model));if(!q1){J("Cannot resolve path for ",i);}o1=k1.createBindingContext(q1);if(n1){m1=O(n1);if(typeof m1!=="function"){J("Cannot resolve helper for ",i);}o1=m1(o1);}if(o1 instanceof b){k1=o1.getModel();q1=o1.getPath();}else if(o1!==undefined){if(typeof o1!=="string"||o1===""){J("Illegal helper result '"+o1+"' in ",i);}q1=o1;}l1.setModel(k1,r1);l1.bindObject({model:r1,path:q1});}else{l1.bindObject(p1);}y++;H(i,r1,"=",q1);if(l1.getBindingContext(r1)===n.getBindingContext(r1)){i1(i,'Set unchanged path:',q1);l1=n;}U(i,l1);i.parentNode.removeChild(i);I(i);y--;}function e1(i,n,j1){if(A){A({context:undefined,env:{caller:"visitAttribute",before:{name:n.name,value:n.value}}});}Z(i,n,j1);if(A){A({context:undefined,env:{caller:"visitAttribute",after:{name:n.name,value:n.value}}});}}function f1(n,j1){var i,k1=n.attributes;for(i=k1.length-1;i>=0;i-=1){e1(n,k1.item(i),j1);}}function g1(j1,k1){var i,l1=j1.childNodes,n=l1.length,m1=new Array(n);for(i=0;i<n;i+=1){m1[i]=l1.item(i);}l1=null;for(i=0;i<n;i+=1){h1(m1[i],k1);}}function h1(n,i){var j1,k1;if(n.nodeType!==1){return;}if(A){A({context:n,env:{caller:"visitNode",before:{name:n.tagName}}});}if(n.namespaceURI===N){switch(l(n)){case"alias":$(n,i);return;case"if":b1(n,i);return;case"repeat":c1(n,i);return;case"with":d1(n,i);return;default:J("Unexpected tag ",n);}}else if(n.namespaceURI==="sap.ui.core"){switch(l(n)){case"ExtensionPoint":if(_(n,i)){return;}break;case"Fragment":if(n.getAttribute("type")==="XML"){a1(n,i);return;}break;}}else{j1=v[n.namespaceURI+" "+l(n)]||v[n.namespaceURI];if(j1){y++;H(n,"Calling visitor");k1=j1(n,G(i));if(k1!==undefined){J("Unexpected return value from visitor for ",n);}I(n);y--;return;}}f1(n,i);g1(n,i);if(A){A({context:n,env:{caller:"visitNode",after:{name:n.tagName}}});}}function i1(i){if(E){if(!k){k=true;q.sap.log.warning("Warning(s) during processing of "+j,null,x);}q.sap.log.warning(L()+Array.prototype.slice.call(arguments,1).join(" "),i&&f(i),x);}}q.sap.measure.average(c,"",p);S=S||{};if(D){H(undefined,"Start processing",j);if(S.bindingContexts instanceof b){H(undefined,"undefined =",S.bindingContexts);}else{for(w in S.bindingContexts){H(undefined,w,"=",S.bindingContexts[w]);}}}if(A){A({context:o,env:{caller:"view",viewinfo:q.extend(true,{},V),settings:q.extend(true,{},S),clone:o.cloneNode(true),type:"template"}});}r(o);h1(o,new W({models:S.models,bindingContexts:S.bindingContexts}));H(undefined,"Finished processing",j);q.sap.measure.end(c);return o;}};},true);
