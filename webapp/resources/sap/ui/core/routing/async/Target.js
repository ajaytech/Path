/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global'],function(q){"use strict";return{display:function(d){var s=Promise.resolve();return this._display(d,s).catch(function(v){if(v instanceof Error){return Promise.reject(v);}else{return v;}});},_display:function(d,s){if(this._oParent){s=this._oParent._display(d,s);}return this._place(d,s);},_place:function(d,s){if(d instanceof Promise){s=d;d=undefined;}var o=this._oOptions,t=this,v,V,a,e;if(o.viewName){V=this._getEffectiveViewName(o.viewName);a={viewName:V,type:o.viewType,id:o.viewId,async:o.async};if(this._bUseRawViewId){v=this._oViews._getViewWithGlobalId(a);}else{v=this._oViews._getView(a);}s=s.then(function(p){return v.loaded().then(function(v){t._bindTitleInTitleProvider(v);t._addTitleProviderAsDependent(v);return{view:v,parentInfo:p||{}};},function(e){return Promise.reject({name:o.name,error:e});});}).then(function(b){var c=t._isValid(b.parentInfo);if(c!==true){e=c;return t._refuseInvalidTarget(o.name,e);}var f=b.parentInfo.view,C=b.parentInfo.control,p=Promise.resolve(C);v=b.view;if(!f&&o.rootView){f=sap.ui.getCore().byId(o.rootView);if(!f){e="Did not find the root view with the id "+o.rootView;return t._refuseInvalidTarget(o.name,e);}}if(o.controlId){if(f){p=f.loaded().then(function(g){return g.byId(o.controlId);});}p=p.then(function(g){if(!g){g=sap.ui.getCore().byId(o.controlId);}if(!g){e="Control with ID "+o.controlId+" could not be found";return t._refuseInvalidTarget(o.name,e);}else{return g;}}).catch(function(){e="Something went wrong during loading the root view with id "+o.rootView;return t._refuseInvalidTarget(o.name,e);});}return p.then(function(g){if(g.error){return g;}t._beforePlacingViewIntoContainer({container:g,view:v,data:d});var A=g.getMetadata().getJSONKeys()[o.controlAggregation];if(!A){e="Control "+o.controlId+" does not have an aggregation called "+o.controlAggregation;return t._refuseInvalidTarget(o.name,e);}if(o.clearControlAggregation===true){g[A._sRemoveAllMutator]();}q.sap.log.info("Did place the view '"+V+"' with the id '"+v.getId()+"' into the aggregation '"+o.controlAggregation+"' of a control with the id '"+g.getId()+"'",t);g[A._sMutator](v);t.fireDisplay({view:v,control:g,config:t._oOptions,data:d});return{name:o.name,view:v,control:g};});});}else{s=s.then(function(){return{name:o.name};});}return s;},_isValid:function(p){var o=this._oOptions,c=p&&p.control,h=(c||o.controlId),i=true,l="";if(!h){l="The target "+o.name+" has no controlId set and no parent so the target cannot be displayed.";i=false;}if(!o.controlAggregation){l="The target "+o.name+" has a control id or a parent but no 'controlAggregation' was set, so the target could not be displayed.";i=false;}if(l){q.sap.log.error(l,this);}return i||l;},_refuseInvalidTarget:function(n,m){if(m){q.sap.log.error(m,this);}return{name:n,error:m};}};});
