/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/rta/plugin/Plugin','sap/ui/rta/Utils'],function(P,U){"use strict";var S=P.extend("sap.ui.rta.plugin.Settings",{metadata:{library:"sap.ui.rta",properties:{commandStack:{type:"any"}},associations:{},events:{}}});S.prototype._isEditable=function(o){if(!U.getRelevantContainerDesigntimeMetadata(o)){return false;}var s=this.getAction(o);if(s){if(s.handler){return this.hasStableId(o);}else{var h=Object.keys(s).some(function(a){return s[a].handler;});if(h){return this.hasStableId(o);}}}return false;};S.prototype.isEnabled=function(o){var a=this.getAction(o);if(!a){return false;}if(typeof a.isEnabled!=="undefined"){if(typeof a.isEnabled==="function"){return a.isEnabled(o.getElementInstance());}else{return a.isEnabled;}}return true;};S.prototype._getUnsavedChanges=function(i,c){var e;var u=this.getCommandStack().getAllExecutedCommands().filter(function(C){e=C.getElementId&&C.getElementId()||C.getElement&&C.getElement().getId();if(e===i&&c.indexOf(C.getChangeType())>=0){return true;}}).map(function(C){return C.getPreparedChange();});return u;};S.prototype.handler=function(s,p){p=p||{};var o,a,c;var e=s[0].getElementInstance();var h=p.fnHandler;if(!h){h=s[0].getDesignTimeMetadata().getAction("settings").handler;if(!h){throw new Error("Handler not found for settings action");}}p.getUnsavedChanges=this._getUnsavedChanges.bind(this);p.styleClass=U.getRtaStyleClassName();return h(e,p).then(function(C){if(C.length>0){c=this.getCommandFactory().getCommandFor(e,"composite");C.forEach(function(m){var b=m.changeSpecificData;if(b.changeType){var v;var d=m.selectorControl;var f;if(d.controlType){f=d.controlType;}else{f=d.getMetadata().getName();}var g=this._getChangeHandlerForControlType(f,b.changeType);if(s[0].getVariantManagement&&g&&g.revertChange){v=s[0].getVariantManagement();}o=this.getCommandFactory().getCommandFor(d,"settings",b,undefined,v);c.addCommand(o);}else if(b.appDescriptorChangeType){var i=m.appComponent;var M=i.getManifest();var r=M["sap.app"].id;a=this.getCommandFactory().getCommandFor(e,"appDescriptor",{reference:r,appComponent:i,changeType:b.appDescriptorChangeType,parameters:b.content.parameters,texts:b.content.texts});c.addCommand(a);}},this);if(c.getCommands().length>0){this.fireElementModified({"command":c});}}}.bind(this))['catch'](function(E){if(E){throw E;}});};S.prototype.getMenuItems=function(o){var s=this.getAction(o);var r=110;var p="CTX_SETTINGS";if(s){if(s.handler){return this._getMenuItems(o,{pluginId:p,rank:r});}else{var m=[];var a=Object.keys(s);var A=0;a.forEach(function(b){var c=s[b],d=this.getActionText(o,c,c.name);if(c.handler){m.push({id:p+A,text:d,enabled:c.isEnabled&&c.isEnabled.bind(this,o.getElementInstance()),handler:function(h,O,e){e=e||{};e.fnHandler=h;return this.handler(O,e);}.bind(this,c.handler),rank:r+A});A++;}else{jQuery.sap.log.warning("Handler not found for settings action '"+d+"'");}}.bind(this));return m;}}};S.prototype.getActionName=function(){return"settings";};return S;},true);
