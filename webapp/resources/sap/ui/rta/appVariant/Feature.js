/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/rta/Utils","sap/ui/fl/Utils","sap/ui/rta/appVariant/AppVariantUtils","sap/m/MessageBox","sap/ui/core/BusyIndicator"],function(q,R,F,A,M,B){"use strict";var a,o;sap.ui.getCore().getEventBus().subscribe("sap.ui.rta.appVariant.manageApps.controller.ManageApps","navigate",function(){if(a){a.destroy();a=null;}});return{onGetOverview:function(r){return new Promise(function(b){var c=function(){sap.ui.getCore().getEventBus().publish("sap.ui.rta.appVariant.manageApps.controller.ManageApps","navigate");};sap.ui.require(["sap/ui/rta/appVariant/ManageAppsDialog"],function(d){if(!a){a=new d("appVariantOverviewDialog",{rootControl:r});}a.attachCancel(c);b(a.open());});});},isPlatFormEnabled:function(l,r){var d=F.getAppDescriptor(r);if(d["sap.app"]&&d["sap.app"].id){return A.getManifirstSupport(d["sap.app"].id).then(function(b){if(R.getUshellContainer()&&!A.isStandAloneApp()&&l==="CUSTOMER"&&b.response){var u=q.sap.getUriParameters();var U=u.mParams["sap-ui-xx-rta-save-as"];if(U&&U.length){var i;if(d["sap.app"].crossNavigation&&d["sap.app"].crossNavigation.inbounds){i=A.getInboundInfo(d["sap.app"].crossNavigation.inbounds);}if(i){return U[0]==='true'?true:false;}}}return false;}).catch(function(e){return A.showTechnicalError(M.Icon.ERROR,"HEADER_APP_VARIANT_FEATURE_FAILED","MSG_APP_VARIANT_FEATURE_FAILED",e);});}return Promise.resolve(false);},onSaveAs:function(r,b){var d,c,e;var E={closeRunningApp:false,copyDirtyChanges:false};if(b){d=b;c=F.getAppDescriptor(r);if(c["sap.app"].id===d["sap.app"].id){E.copyDirtyChanges=true;}}else{d=F.getAppDescriptor(r);E.closeRunningApp=true;E.copyDirtyChanges=true;}return new Promise(function(f,g){sap.ui.require(["sap/ui/rta/appVariant/AppVariantManager"],function(h){if(!o){o=new h();}return o.processSaveAsDialog(d).then(function(i){return o.createDescriptor(i);}).then(function(b){if(b){B.show();e=b;return o.saveAppVariantToLREP(b);}else{return false;}}).then(function(s){if(s){return o.copyUnsavedChangesToLREP(e._id,r,E.copyDirtyChanges);}else{return false;}}).then(function(s){if(s){return o.triggerCatalogAssignment(e);}else{return false;}}).then(function(i){if(i){B.hide();var u=R.getUshellContainer();if(u){u.setDirtyFlag(false);}return o.showSuccessMessageAndTriggerActionFlow(e,E.closeRunningApp,r).then(function(){if(i&&i.response&&i.response.IAMId){return o.notifyKeyUserWhenTileIsReady(i.response.IAMId,e._id);}else{f();}});}else{return false;}})["catch"](function(){f(false);});});});}};});
