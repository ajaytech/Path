/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/Controller","sap/ui/rta/appVariant/manageApps/webapp/model/models","sap/ui/rta/appVariant/Utils","sap/m/MessageBox","sap/ui/rta/Utils","sap/ui/rta/appVariant/Feature","sap/ui/rta/RuntimeAuthoring","sap/ui/core/BusyIndicator","sap/ui/rta/appVariant/AppVariantUtils"],function(q,C,M,A,a,R,b,c,B,d){"use strict";var _,e,m,i;return C.extend("sap.ui.rta.appVariant.manageApps.webapp.controller.ManageApps",{onInit:function(){_=this.getOwnerComponent().getIdRunningApp();e=this.getOwnerComponent().getRootControlRunningApp();m=q.sap.getModulePath("sap.ui.rta.appVariant.manageApps.webapp");i=q.sap.resources({url:m+"/i18n/i18n.properties"});B.show();return A.getAppVariantOverview(_).then(function(f){B.hide();return this._arrangeOverviewDataAndBindToModel(f).then(function(f){return this._highlightNewCreatedAppVariant(f);}.bind(this));}.bind(this))["catch"](function(E){B.hide();return d.showTechnicalError(a.Icon.ERROR,"HEADER_MANAGE_APPS_FAILED","MSG_MANAGE_APPS_FAILED",E);});},_highlightNewCreatedAppVariant:function(f){var t=this.getView().byId("Table1");q('.maaCurrentStatus,.maaSubTitle').css("font-size",'12px');f.forEach(function(o,g){if(o.rowStatus==="Information"){t.setFirstVisibleRow(g);}});return Promise.resolve();},_arrangeOverviewDataAndBindToModel:function(f){var g=f.filter(function(l){return l.appId===_;});var o=g[0];if(o){o.currentStatus=i.getText("MAA_CURRENTLY_ADAPTING");o.rowStatus="Success";}f=f.filter(function(l){return l.appId!==_;});f.unshift(o);var r=f.filter(function(l){return l.isOriginal;});var h=r[0];f=f.filter(function(l){return!l.isOriginal;});f.unshift(h);var j={appVariants:f};var k=M.createModel(j);this.getView().setModel(k);return Promise.resolve(f);},getModelProperty:function(s,f){return this.getView().getModel().getProperty(s,f);},handleUiAdaptation:function(E){var n=sap.ushell.Container.getService("CrossApplicationNavigation");var s=this.getModelProperty("semanticObject",E.getSource().getBindingContext());var f=this.getModelProperty("action",E.getSource().getBindingContext());var p=this.getModelProperty("params",E.getSource().getBindingContext());var N;if(s&&f&&p){N={target:{semanticObject:s,action:f},params:p};c.enableRestart("CUSTOMER");n.toExternal(N);sap.ui.getCore().getEventBus().publish("sap.ui.rta.appVariant.manageApps.controller.ManageApps","navigate");}else{return false;}},saveAsAppVariant:function(E){sap.ui.getCore().getEventBus().publish("sap.ui.rta.appVariant.manageApps.controller.ManageApps","navigate");var D=this.getModelProperty("descriptorUrl",E.getSource().getBindingContext());B.show();return A.getDescriptor(D).then(function(o){B.hide();return b.onSaveAs(e,o);})["catch"](function(o){B.hide();return d.showTechnicalError(a.Icon.ERROR,"HEADER_MANAGE_APPS_FAILED","MSG_MANAGE_APPS_FAILED",o);});},copyId:function(E){var s=this.getModelProperty("appId",E.getSource().getBindingContext());d.copyId(s);}});});
