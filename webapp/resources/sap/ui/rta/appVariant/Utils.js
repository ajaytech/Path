/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/fl/LrepConnector","sap/ui/rta/appVariant/AppVariantUtils"],function(q,L,A){"use strict";var U={};var m=q.sap.getModulePath("sap.ui.rta.appVariant.manageApps.webapp");var i=q.sap.resources({url:m+"/i18n/i18n.properties"});U.sendRequest=function(r,o){var l=L.createConnector();return l.send(r,o);};U.getAppVariantOverviewAttributes=function(a){var o;var c=function(){if(a.isOriginal&&a.isAppVariant){return i.getText("MAA_ORIGINAL_TYPE");}else if(a.isAppVariant){return i.getText("MAA_APP_VARIANT_TYPE");}else if(a.isOriginal){return i.getText("MAA_ORIGINAL_TYPE");}};var f=function(N){var b=sap.ushell.Container.getService("CrossApplicationNavigation");return b.getLinks(N);};var g=function(o){if(a.hasStartableIntent){var s=a.startWith.semanticObject;var b=a.startWith.action;var p=a.startWith.parameters;var N={semanticObject:s,action:b,params:p};return f(N).then(function(r){if(r.length){o.adaptUIButtonVisibility=true;}else{o.adaptUIButtonVisibility=false;}o.semanticObject=s;o.action=b;if(p){Object.keys(p).forEach(function(P){if(p[P].value){p[P]=p[P].value;}});o.params=p;}return Promise.resolve(o);});}else{o.adaptUIButtonVisibility=false;return Promise.resolve(o);}};o={appId:a.appId,title:a.title,subTitle:a.subTitle,description:a.description,icon:a.iconUrl,originalId:a.originalId,isOriginal:a.isOriginal,typeOfApp:c(),descriptorUrl:a.descriptorUrl};var n=A.getNewAppVariantId();if(n===a.appId){o.rowStatus="Information";}return g(o);};U.getAppVariantOverview=function(r){var R='/sap/bc/lrep/app_variant_overview/?sap.app/id='+r;return this.sendRequest(R,'GET').then(function(o){var a=[];var b=o.response.items;if(b.length){var t=this;b.forEach(function(c){if(!c.isDescriptorVariant){a.push(t.getAppVariantOverviewAttributes(c));}});return Promise.all(a).then(function(c){return c;});}}.bind(this));};U.getDescriptor=function(d){return this.sendRequest(d,'GET').then(function(r){return r.response;});};return U;},true);
