/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/ui/support/supportRules/Constants"],function(q,B,c){"use strict";var _=[];var a=[];var b=function(i){var e=sap.ui.getCore().byId(i.context.id),f="";if(i.context.id==="WEBPAGE"){f="sap.ui.core";}else if(e){f=e.getMetadata().getName();}return{severity:i.severity,name:i.rule.title,description:i.rule.description,resolution:i.rule.resolution,resolutionUrls:i.rule.resolutionurls,audiences:i.rule.audiences,categories:i.rule.categories,details:i.details,ruleLibName:i.rule.libName,ruleId:i.rule.id,async:i.rule.async===true,minVersion:i.rule.minversion,context:{className:f,id:i.context.id}};};var I={addIssue:function(i){_.push(i);},walkIssues:function(C){_.forEach(C);},clearIssues:function(){_=[];},saveHistory:function(){a.push({issues:_.slice()});},getHistory:function(){return a.slice();},getConvertedHistory:function(){var t=this,i=t.getHistory(),e=[],f=null;i.forEach(function(r){f=t.groupIssues(t.convertToViewModel(r.issues));e.push({issues:f});});return e;},getIssuesModel:function(){var v=[];this.walkIssues(function(i){v.push(b(i));});return v;},getRulesViewModel:function(r,s,i){var e={},f=0,g={},l={},h={},j=q.extend(true,{},r),k=q.extend(true,{},i);for(g in j){e[g]=q.extend(true,{},j[g].ruleset._mRules);l=e[g];Object.defineProperty(l,'selected',{enumerable:false,configurable:true,writable:true,value:false});Object.defineProperty(l,'issueCount',{enumerable:false,configurable:true,writable:true,value:0});for(h in j[g].ruleset._mRules){l[h]=q.extend(true,[],l[h]);Object.defineProperty(l[h],'selected',{enumerable:false,configurable:true,writable:true,value:false});Object.defineProperty(l[h],'issueCount',{enumerable:false,configurable:true,writable:true,value:0});if(s[h]){l[h].selected=true;l.selected=true;}if(k[g]&&k[g][h]){l[h].push.apply(l[h],k[g][h]);f=k[g][h].length;l[h].issueCount=f;l.issueCount+=f;}}}return e;},getTreeTableViewModel:function(r){var i=0,e=0,t={},f;f=this.getRulesViewModel(r,[],[]);for(var l in f){t[i]={name:l,type:"lib",rules:[]};for(var g in f[l]){t[i][e]={name:f[l][g].title,description:f[l][g].description,id:f[l][g].id,audiences:f[l][g].audiences,categories:f[l][g].categories,minversion:f[l][g].minversion,resolution:f[l][g].resolution,title:f[l][g].title,libName:l};e++;}i++;}return t;},getIssuesViewModel:function(i){var t={},e=0,f=0,g=0,s,h=0,m=0,l=0;for(var j in i){t[e]={name:j,showAudiences:false,showCategories:false,type:"lib"};for(var r in i[j]){s=this._sortSeverityIssuesByPriority(i[j][r]);t[e][f]={formatedName:i[j][r][0].name+" (<span style=\"color:"+c.SUPPORT_ASSISTANT_SEVERITY_HIGH_COLOR+";\"> "+s.high+" H, </span> "+"<span style=\"color:"+c.SUPPORT_ASSISTANT_SEVERITY_MEDIUM_COLOR+";\"> "+s.medium+" M, </span> "+"<span style=\"color:"+c.SUPPORT_ASSISTANT_SEVERITY_LOW_COLOR+";\"> "+s.low+" L) </span>",name:i[j][r][0].name,showAudiences:true,showCategories:true,categories:i[j][r][0].categories.join(", "),audiences:i[j][r][0].audiences.join(", "),issueCount:i[j][r].length,description:i[j][r][0].description,resolution:i[j][r][0].resolution,type:"rule",ruleLibName:i[j][r][0].ruleLibName,ruleId:i[j][r][0].ruleId,selected:i[j][r][0].selected,details:i[j][r][0].details,severity:i[j][r][0].severity};g+=i[j][r].length;f++;h+=s.high;m+=s.medium;l+=s.low;}t[e].formatedName=t[e].name+" ("+"<span style=\"color: "+c.SUPPORT_ASSISTANT_SEVERITY_HIGH_COLOR+"; \"> "+h+" High, </span> "+"<span style=\"color:  "+c.SUPPORT_ASSISTANT_SEVERITY_MEDIUM_COLOR+";\"> "+m+" Medium, </span> "+"<span style=\"color "+c.SUPPORT_ASSISTANT_SEVERITY_LOW_COLOR+";\"> "+l+" Low </span>)";t[e].name+=" ("+g+" issues)";t[e].issueCount=g;g=0;f=0;e++;h=0;m=0;l=0;}return t;},_sortSeverityIssuesByPriority:function(i){var h=0,m=0,l=0;i.forEach(function(e){switch(e.severity){case c.SUPPORT_ASSISTANT_ISSUE_SEVERITY_LOW:l++;break;case c.SUPPORT_ASSISTANT_ISSUE_SEVERITY_MEDIUM:m++;break;case c.SUPPORT_ASSISTANT_ISSUE_SEVERITY_HIGH:h++;break;}});return{high:h,medium:m,low:l};},clearHistory:function(){a=[];},convertToViewModel:function(o){var v=[];for(var i=0;i<o.length;i++){v.push(b(o[i]));}return v;},groupIssues:function(o){var g={},e={};for(var i=0;i<o.length;i++){e=o[i];if(!g[e.ruleLibName]){g[e.ruleLibName]={};}if(!g[e.ruleLibName][e.ruleId]){g[e.ruleLibName][e.ruleId]=[];}g[e.ruleLibName][e.ruleId].push(e);}return g;},createIssueManagerFacade:function(r){return new d(r);}};var d=function(r){this.oRule=r;};d.prototype.addIssue=function(i){i.rule=this.oRule;if(!sap.ui.support.Severity[i.severity]){throw"The issue from rule "+this.oRule.title+" does not have proper severity defined. Allowed values can be found"+"in sap.ui.support.Severity";}if(!i.context||!i.context.id){throw"The issue from rule '"+this.oRule.title+"' should provide a context id.";}if(!i.details){throw"The issue from rule '"+this.oRule.title+"' should provide details for the generated issue.";}I.addIssue(i);};return I;},true);
