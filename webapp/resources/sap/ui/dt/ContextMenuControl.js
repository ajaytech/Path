/*
 * ! UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','./library','sap/ui/unified/Menu','sap/ui/unified/MenuItem','sap/ui/fl/Utils'],function(q,l,M,a,f){"use strict";var C=M.extend("sap.ui.dt.ContextMenuControl",{metadata:{library:"sap.ui.dt",properties:{},associations:{},events:{}},renderer:{}});C.prototype.aStyleClasses=[];C.prototype.init=function(){M.prototype.init.apply(this,arguments);this.addStyleClass("sapUiDtContextMenu");this._fnOnKeyDown=this._onKeyDown.bind(this);q(document).keydown(this._fnOnKeyDown);this.attachBrowserEvent("contextmenu",this._onContextMenu,this);this._oOverlayDomRef=document.body;};C.prototype.exit=function(){M.prototype.exit.apply(this,arguments);q(document).off("keydown",this._fnOnKeyDown);delete this._fnOnKeyDown;this.detachBrowserEvent("contextmenu");};C.prototype.setOverlayDomRef=function(o){this._oOverlayDomRef=o.getDomRef();};C.prototype.addStyleClass=function(s){if(this.aStyleClasses.indexOf(s)===-1){this.aStyleClasses.push(s);}M.prototype.addStyleClass.apply(this,arguments);};C.prototype._createSubMenuWithBinding=function(r,t,e){var A=f.getAppComponentForControl(t.getElementInstance()),s=A.getModel(r.submenu.model),c=r.submenu.current(t,s),S=r.submenu.items(t,s);var m=S.map(function(b){var d=(c===b.key),i=d?"sap-icon://journey-depart":"";var g=new a({text:b.title,icon:i,enabled:!d});return g.data({id:r.id,key:b.key,current:c,targetOverlay:t});},this);var o=new M({enabled:e,items:m});this.aStyleClasses.forEach(function(b){o.addStyleClass(b);});return o;};C.prototype.setMenuItems=function(m,t){this.destroyItems();var s=[];m.forEach(function(i){if(!i.available||i.available(t)){var e=!i.enabled||i.enabled(t);var T=i.text;if(typeof i.text==="function"){T=i.text(t);}var o=new a({text:T,enabled:e});if(i.type==="subMenuWithBinding"){var S=this._createSubMenuWithBinding(i,t,e);o.setSubmenu(S);}o.data({id:i.id});if((i.startSection&&typeof(i.startSection)==="boolean")||(typeof(i.startSection)==="function"&&i.startSection(t.getElementInstance()))){o.setStartsSection(true);}if(s.length>0){s.slice(-1)[0].addItem(o);}else{this.addItem(o);}}},this);return this;};C.prototype.openMenu=function(o,t){if(this.getItems().length===0||!t.getDomRef()){return;}this.openAsContextMenu(o,t);};C.prototype._onKeyDown=function(e){if(!this.bOpen){q(document).off("keydown",this._fnOnKeyDown);delete this._fnOnKeyDown;return;}if((e.keyCode===q.sap.KeyCodes.F10)&&(e.shiftKey===true)&&(e.altKey===false)&&(e.ctrlKey===false)){e.preventDefault();}};C.prototype._onContextMenu=function(e){if(!this.bOpen){this.detachBrowserEvent("contextmenu");return;}if(e.preventDefault){e.preventDefault();}};return C;},true);
