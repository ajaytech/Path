/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/core/Control','./ResponsiveFlowLayoutData','./library','sap/ui/core/ResizeHandler','sap/ui/Device'],function(q,C,R,l,a,D){"use strict";var b=C.extend("sap.ui.layout.ResponsiveFlowLayout",{metadata:{library:"sap.ui.layout",properties:{responsive:{type:"boolean",group:"Misc",defaultValue:true}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}}}});(function(){b.prototype.init=function(){this._rows=[];this._bIsRegistered=false;this._proxyComputeWidths=q.proxy(e,this);this._iRowCounter=0;};b.prototype.exit=function(){delete this._rows;if(this._IntervalCall){q.sap.clearDelayedCall(this._IntervalCall);this._IntervalCall=undefined;}if(this._resizeHandlerComputeWidthsID){a.deregister(this._resizeHandlerComputeWidthsID);}delete this._resizeHandlerComputeWidthsID;delete this._proxyComputeWidths;if(this.oRm){this.oRm.destroy();delete this.oRm;}delete this._$DomRef;delete this._oDomRef;delete this._iRowCounter;};var u=function(t){var f=t.getContent();var r=[];var h=-1;var I={},L={};var s="";var o;var m=0,w=0,j=0;var B=false,M=false,k=false;for(var i=0;i<f.length;i++){m=R.MIN_WIDTH;w=R.WEIGHT;B=R.LINEBREAK;M=R.MARGIN;k=R.LINEBREAKABLE;o=_(f[i]);if(o instanceof R){B=o.getLinebreak();m=o.getMinWidth();w=o.getWeight();M=o.getMargin();k=o.getLinebreakable();}if(h<0||B){h++;r.push({height:-1,cont:[]});}j=r[h].cont.length;s=f[i].getId()+"-cont"+h+"_"+j;I={minWidth:m,weight:w,linebreakable:k,padding:M,control:f[i],id:s,breakWith:[]};var p=false;if(!k){for(var n=j;n>0;n--){L=r[h].cont[n-1];if(L.linebreakable){L.breakWith.push(I);p=true;break;}}}if(!p){r[h].cont.push(I);}}t._rows=r;};var g=function(o,$,t){var r=[];var f=10000000;var h=-1;var k=function(j){var m=q.sap.byId(o.cont[j].id);if(m.length>0){var n=m[0].offsetLeft;if(f>=n){r.push({cont:[]});h++;}f=n;r[h].cont.push(o.cont[j]);}};if(sap.ui.getCore().getConfiguration().getRTL()){for(var i=o.cont.length-1;i>=0;i--){k(i);}}else{for(var i=0;i<o.cont.length;i++){k(i);}}return r;};var c=function(o,w){var r=[];var f=-1;var h=0;var t=0;var i=0;var m=0,n=0;var j=0,k=0;for(j=0;j<o.cont.length;j++){h=0;t=0;for(k=i;k<=j;k++){t=t+o.cont[k].weight;}for(k=i;k<=j;k++){m=w/t*o.cont[k].weight;m=Math.floor(m);n=o.cont[k].minWidth;h+=Math.max(m,n);}if(f==-1||h>w){r.push({cont:[]});if(f!==-1){i=j;}f++;}r[f].cont.push(o.cont[j]);}return r;};var d=function(w,f){if(w.length!=f.length){return true;}for(var i=0;i<w.length;i++){if(w[i].cont.length!=f[i].cont.length){return true;}}return false;};b.prototype.renderContent=function(t,w){var r=t,f=0,W=[],i=0,h=0,j=0,k=0,m=0,p=0,o,n=0,s=0,B=[],v=[],I=this.getId(),H="",x=this._getRenderManager();for(i=0;i<r.length;i++){p=0;W.length=0;f=100;v.length=0;v.push("sapUiRFLRow");if(r[i].cont.length<=1){v.push("sapUiRFLCompleteRow");}var y=I+"-row"+this._iRowCounter;var S={};x.writeHeader(y,S,v);m=0;for(h=0;h<r[i].cont.length;h++){m+=r[i].cont[h].weight;}for(j=0;j<r[i].cont.length;j++){o=r[i].cont[j];n=0;s=0;if(o.breakWith.length>0){n=o.weight;s=o.minWidth;for(var z=0;z<o.breakWith.length;z++){n+=o.breakWith[z].weight;s+=o.breakWith[z].minWidth;}}H=r[i].cont[j].id;v.length=0;S={"min-width":o.breakWith.length>0?s:o.minWidth};p=100/m*o.weight;var P=S["min-width"]/w*100;var A=Math.ceil(P);var E=Math.floor(p);if(E!==100&&A>E){p=A;}else{p=E;}p=f<p?f:p;f-=p;W.push(p);if(f>0&&j===(r[i].cont.length-1)){p+=f;}v.push("sapUiRFLContainer");S["width"]=p+"%";S["min-width"]=S["min-width"]+"px";x.writeHeader(H,S,v);v.length=0;v.push("sapUiRFLContainerContent");if(o.breakWith.length>0){v.push("sapUiRFLMultiContainerContent");}if(o.padding){v.push("sapUiRFLPaddingClass");}var F=this._addContentClass(o.control,j);if(F){v.push(F);}S={};x.writeHeader("",S,v);if(o.breakWith.length>0){H=r[i].cont[j].id+"-multi0";v.length=0;S={"min-width":s+"px"};var G=100/n*o.weight;G=Math.floor(G);B.push(G);v.push("sapUiRFLMultiContent");S["width"]=G+"%";if(r[i].cont[j].padding){v.push("sapUiRFLPaddingClass");}x.writeHeader(H,S,v);var J=G;x.renderControl(o.control);x.write("</div>");for(k=0;k<o.breakWith.length;k++){H=o.breakWith[k].id+'-multi'+(k+1);v.length=0;S={"min-width":o.breakWith[k].minWidth+"px"};G=100/n*o.breakWith[k].weight;G=Math.floor(G);B.push(G);J+=G;if(J<100&&k===(o.breakWith.length-1)){G+=100-J;}v.push("sapUiRFLMultiContent");S["width"]=G+"%";if(o.breakWith[k].padding){v.push("sapUiRFLPaddingClass");}x.writeHeader(H,S,v);x.renderControl(o.breakWith[k].control);x.write("</div>");}}else{x.renderControl(o.control);}x.write("</div>");x.write("</div>");}x.write("</div>");this._iRowCounter++;}};var e=function(I){this._iRowCounter=0;this._oDomRef=this.getDomRef();if(this._oDomRef){var s=this.getId();var f=q(this._oDomRef).width();var r=false;if(this._rows){for(var i=0;i<this._rows.length;i++){var $=this._$DomRef.find("#"+s+"-row"+i);var t=c(this._rows[i],f);var o=g(this._rows[i],$,this);r=d(o,t);var h=this._getElementRect($);var p=this._rows[i].oRect;if(h&&p){r=r||(h.width!==p.width)&&(h.height!==p.height);}r=r||(typeof(I)==="boolean"&&I);if(this._bLayoutDataChanged||r){if(D.browser.internet_explorer){q(this._oDomRef).empty();}else{this._oDomRef.innerHTML="";}this._bLayoutDataChanged=false;this.renderContent(t,f);}}if(this._oDomRef.innerHTML===""){this._getRenderManager().flush(this._oDomRef);for(var i=0;i<this._rows.length;i++){var T=this._getElementRect(q.sap.byId(s+"-row"+i));this._rows[i].oRect=T;}}if(this._rows.length===0){if(this._resizeHandlerComputeWidthsID){a.deregister(this._resizeHandlerComputeWidthsID);delete this._resizeHandlerComputeWidthsID;}}}}};b.prototype.onBeforeRendering=function(){u(this);if(this._resizeHandlerFullLengthID){a.deregister(this._resizeHandlerFullLengthID);delete this._resizeHandlerFullLengthID;}};b.prototype.onAfterRendering=function(E){this._oDomRef=this.getDomRef();this._$DomRef=q(this._oDomRef);this._proxyComputeWidths(true);if(this.getResponsive()){if(!this._resizeHandlerComputeWidthsID){this._resizeHandlerComputeWidthsID=a.register(this,this._proxyComputeWidths);}}else{if(this._resizeHandlerComputeWidthsID){a.deregister(this._resizeHandlerComputeWidthsID);delete this._resizeHandlerComputeWidthsID;}}};b.prototype.onThemeChanged=function(E){if(E.type==="LayoutDataChange"){this._bLayoutDataChanged=true;}if(!this._resizeHandlerComputeWidthsID){this._resizeHandlerComputeWidthsID=a.register(this,this._proxyComputeWidths);}u(this);this._proxyComputeWidths();};b.prototype.onLayoutDataChange=b.prototype.onThemeChanged;var _=function(o){var L=o.getLayoutData();if(!L){return undefined;}else if(L instanceof R){return L;}else if(L.getMetadata().getName()=="sap.ui.core.VariantLayoutData"){var f=L.getMultipleLayoutData();for(var i=0;i<f.length;i++){var h=f[i];if(h instanceof R){return h;}}}};b.prototype.addContent=function(o){if(o&&this._IntervalCall){q.sap.clearDelayedCall(this._IntervalCall);this._IntervalCall=undefined;}this.addAggregation("content",o);};b.prototype.insertContent=function(o,i){if(o&&this._IntervalCall){q.sap.clearDelayedCall(this._IntervalCall);this._IntervalCall=undefined;}this.insertAggregation("content",o,i);};b.prototype.removeContent=function(o){if(o&&this._IntervalCall){q.sap.clearDelayedCall(this._IntervalCall);this._IntervalCall=undefined;}this.removeAggregation("content",o);};b.prototype._getAccessibleRole=function(){return null;};b.prototype._addContentClass=function(o,i){return null;};b.prototype._getElementRect=function(E){var r=E&&E.rect();if(r){r.height=r.height.toFixed(1);r.width=r.width.toFixed(1);}return r;};b.prototype._getRenderManager=function(){if(!this.oRm){this.oRm=sap.ui.getCore().createRenderManager();this.oRm.writeStylesAndClasses=function(){this.writeStyles();this.writeClasses();};this.oRm.writeHeader=function(I,s,f){this.write('<div id="'+I+'"');if(s){for(var k in s){if(k==="width"&&s[k]==="100%"){this.addClass("sapUiRFLFullLength");}this.addStyle(k,s[k]);}}for(var i=0;i<f.length;i++){this.addClass(f[i]);}this.writeStylesAndClasses();this.write(">");};}return this.oRm;};}());return b;});
