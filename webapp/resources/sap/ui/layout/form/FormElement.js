/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/core/Element','sap/ui/base/ManagedObjectObserver','sap/ui/layout/library'],function(q,E,M,l){"use strict";var F=E.extend("sap.ui.layout.form.FormElement",{metadata:{library:"sap.ui.layout",properties:{visible:{type:"boolean",group:"Misc",defaultValue:true}},defaultAggregation:"fields",aggregations:{label:{type:"sap.ui.core.Label",altTypes:["string"],multiple:false},_label:{type:"sap.ui.core.Label",multiple:false,visibility:"hidden"},fields:{type:"sap.ui.core.Control",multiple:true,singularName:"field"}},designTime:true}});F.prototype.init=function(){this._oFieldDelegate={oElement:this,onAfterRendering:h};this._oObserver=new M(this._observeChanges.bind(this));this._oObserver.observe(this,{aggregations:["fields"]});};F.prototype.exit=function(){if(this._oLabel){delete this._oLabel;}this._oFieldDelegate=undefined;this._oObserver.disconnect();this._oObserver=undefined;};F.prototype.setLabel=function(A){if(!this._oLabel){var o=this.getLabel();if(o){if(o.setAlternativeLabelFor){o.setAlternativeLabelFor(null);}if(o.isRequired){o.isRequired=o._sapuiIsRequired;o._sapuiIsRequired=undefined;o.disableRequiredChangeCheck(false);}if(o.isDisplayOnly){o.isDisplayOnly=o._sapuiIsDisplayOnly;o._sapuiIsDisplayOnly=undefined;}}}this.setAggregation("label",A);var L=A;if(typeof L==="string"){if(!this._oLabel){this._oLabel=l.form.FormHelper.createLabel(L);this.setAggregation("_label",this._oLabel,true);this._oLabel.disableRequiredChangeCheck(true);if(this._oLabel.isRequired){this._oLabel.isRequired=c;}if(this._oLabel.isDisplayOnly){this._oLabel.isDisplayOnly=d;}}else{this._oLabel.setText(L);}}else{if(this._oLabel){this._oLabel.destroy();delete this._oLabel;}if(L&&L.isRequired){L._sapuiIsRequired=L.isRequired;L.isRequired=c;L.disableRequiredChangeCheck(true);}if(L&&L.isDisplayOnly){L._sapuiIsDisplayOnly=L.isDisplayOnly;L.isDisplayOnly=d;}}e.call(this);return this;};F.prototype.destroyLabel=function(){this.destroyAggregation("label");if(this._oLabel){this._oLabel.destroy();delete this._oLabel;}return this;};F.prototype.getLabelControl=function(){if(this._oLabel){return this._oLabel;}else{return this.getLabel();}};F.prototype.updateFields=function(){var j=this.getFields();var o;var i=0;for(i=0;i<j.length;i++){o=j[i];g.call(this,o);}this.updateAggregation("fields");j=this.getFields();for(i=0;i<j.length;i++){o=j[i];f.call(this,o);}e.call(this);return this;};F.prototype.enhanceAccessibilityState=function(o,A){var L=this.getLabelControl();if(L&&L!=o){var s=A["labelledby"];if(!s){s=L.getId();}else{var i=s.split(" ");if(q.inArray(L.getId(),i)<0){i.splice(0,0,L.getId());s=i.join(" ");}}A["labelledby"]=s;}return A;};F.prototype.onLayoutDataChange=function(o){var p=this.getParent();if(p&&p.onLayoutDataChange){p.onLayoutDataChange(o);}};F.prototype.getRenderedDomRef=function(){var t=this;var C=this.getParent();if(C&&C.getElementRenderedDomRef){return C.getElementRenderedDomRef(t);}else{return null;}};F.prototype.invalidateLabel=function(){var L=this.getLabelControl();if(L){L.invalidate();}};F.prototype.isVisible=function(){return this.getVisible();};F.prototype._observeChanges=function(C){if(C.object==this){if(C.name=="fields"){_.call(this,C);}}else{b.call(this,C);}};function _(C){if(C.child){a.call(this,C.child,C.mutation);}else if(C.children){for(var i=0;i<C.chlidren.length;i++){a.call(this,C.children[i],C.mutation);}}e.call(this);}function a(o,m){if(m=="insert"){if(!o.getMetadata().isInstanceOf("sap.ui.core.IFormContent")){q.sap.log.warning(o+" is not valid Form content",this);}f.call(this,o);}else{g.call(this,o);}}function b(C){if(C.name=="required"){this.invalidateLabel();}}function c(){if(this.getRequired&&this.getRequired()){return true;}var o=this.getParent();var j=o.getFields();for(var i=0;i<j.length;i++){var k=j[i];if(k.getRequired&&k.getRequired()===true&&(!k.getEditable||k.getEditable())){return true;}}return false;}function d(){if(this.getDisplayOnly){if(!this.isPropertyInitial("displayOnly")){return this.getDisplayOnly();}var o=this.getParent();var i=o.getParent();if(i){var j=i.getParent();if(j){return!j.getEditable();}}}return false;}function e(){var i=this.getFields();var o=i.length>0?i[0]:null;var L=this._oLabel;if(L){L.setLabelFor(o);}else{L=this.getLabel();if(L instanceof sap.ui.core.Control){L.setAlternativeLabelFor(o);}}}function f(o){o.addDelegate(this._oFieldDelegate);if(!this._bNoObserverChange&&o.getMetadata().getProperty("required")){this._oObserver.observe(o,{properties:["required"]});}}function g(o){o.removeDelegate(this._oFieldDelegate);if(!this._bNoObserverChange){this._oObserver.unobserve(o);}}function h(o){var p=this.oElement.getParent();if(p&&p.contentOnAfterRendering){p.contentOnAfterRendering(this.oElement,o.srcControl);}}return F;});
