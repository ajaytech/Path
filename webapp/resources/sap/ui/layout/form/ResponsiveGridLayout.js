/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/layout/Grid','sap/ui/layout/GridData','./FormLayout','sap/ui/layout/library','sap/ui/core/Control','sap/ui/core/ResizeHandler'],function(q,G,a,F,l,C,R){"use strict";var b=F.extend("sap.ui.layout.form.ResponsiveGridLayout",{metadata:{library:"sap.ui.layout",properties:{labelSpanXL:{type:"int",group:"Misc",defaultValue:-1},labelSpanL:{type:"int",group:"Misc",defaultValue:4},labelSpanM:{type:"int",group:"Misc",defaultValue:2},labelSpanS:{type:"int",group:"Misc",defaultValue:12},adjustLabelSpan:{type:"boolean",group:"Misc",defaultValue:true},emptySpanXL:{type:"int",group:"Misc",defaultValue:-1},emptySpanL:{type:"int",group:"Misc",defaultValue:0},emptySpanM:{type:"int",group:"Misc",defaultValue:0},emptySpanS:{type:"int",group:"Misc",defaultValue:0},columnsXL:{type:"int",group:"Misc",defaultValue:-1},columnsL:{type:"int",group:"Misc",defaultValue:2},columnsM:{type:"int",group:"Misc",defaultValue:1},singleContainerFullSize:{type:"boolean",group:"Misc",defaultValue:true},breakpointXL:{type:"int",group:"Misc",defaultValue:1440},breakpointL:{type:"int",group:"Misc",defaultValue:1024},breakpointM:{type:"int",group:"Misc",defaultValue:600}}}});var P=C.extend("sap.ui.layout.form.ResponsiveGridLayoutPanel",{metadata:{aggregations:{"content":{type:"sap.ui.layout.Grid",multiple:false}},associations:{"container":{type:"sap.ui.layout.form.FormContainer",multiple:false},"layout":{type:"sap.ui.layout.form.ResponsiveLayout",multiple:false}}},getLayoutData:function(){var o=sap.ui.getCore().byId(this.getContainer());var L=sap.ui.getCore().byId(this.getLayout());var i;if(L&&o){i=L.getLayoutDataForElement(o,"sap.ui.layout.GridData");}if(i){return i;}else{return this.getAggregation("layoutData");}},getCustomData:function(){var o=sap.ui.getCore().byId(this.getContainer());if(o){return o.getCustomData();}},refreshExpanded:function(){var o=sap.ui.getCore().byId(this.getContainer());if(o){if(o.getExpanded()){this.$().removeClass("sapUiRGLContainerColl");}else{this.$().addClass("sapUiRGLContainerColl");}}},renderer:function(r,p){var o=sap.ui.getCore().byId(p.getContainer());var L=sap.ui.getCore().byId(p.getLayout());var i=p.getContent();var E=o.getExpandable();var t=o.getTooltip_AsString();var T=o.getToolbar();var j=o.getTitle();r.write("<div");r.writeControlData(p);r.addClass("sapUiRGLContainer");if(E&&!o.getExpanded()){r.addClass("sapUiRGLContainerColl");}if(T){r.addClass("sapUiFormContainerToolbar");}else if(j){r.addClass("sapUiFormContainerTitle");}if(t){r.writeAttributeEscaped('title',t);}r.writeClasses();L.getRenderer().writeAccessibilityStateContainer(r,o);r.write(">");if(T){r.renderControl(T);}else if(o.getTitle()){L.getRenderer().renderTitle(r,j,o._oExpandButton,E,false,o.getId());}if(i){r.write("<div");r.addClass("sapUiRGLContainerCont");r.writeClasses();r.write(">");r.renderControl(i);r.write("</div>");}r.write("</div>");}});b.prototype.init=function(){this.mContainers={};this.oDummyLayoutData=new a(this.getId()+"--Dummy");};b.prototype.exit=function(){for(var s in this.mContainers){k.call(this,s);}if(this._mainGrid){this._mainGrid.destroy();delete this._mainGrid;}this.oDummyLayoutData.destroy();this.oDummyLayoutData=undefined;};b.prototype.onBeforeRendering=function(E){var o=this.getParent();if(!o||!(o instanceof sap.ui.layout.form.Form)){return;}o._bNoInvalidate=true;_.call(this,o);m.call(this,o);o._bNoInvalidate=false;};b.prototype.onAfterRendering=function(E){if(this._mainGrid&&this._mainGrid.__bIsUsed){for(var s in this.mContainers){if(this.mContainers[s][1]._sContainerResizeListener){R.deregister(this.mContainers[s][1]._sContainerResizeListener);this.mContainers[s][1]._sContainerResizeListener=null;}}}};b.prototype.contentOnAfterRendering=function(o,i){F.prototype.contentOnAfterRendering.apply(this,arguments);if(i.getWidth&&(!i.getWidth()||i.getWidth()=="auto")&&(!i.getFormDoNotAdjustWidth||!i.getFormDoNotAdjustWidth())){i.$().css("width","100%");}};b.prototype.toggleContainerExpanded=function(o){var s=o.getId();if(this.mContainers[s]&&this.mContainers[s][0]){var p=this.mContainers[s][0];p.refreshExpanded();}};b.prototype.onLayoutDataChange=function(E){var s=E.srcControl;if(s instanceof sap.ui.layout.form.FormContainer){if(this._mainGrid){this._mainGrid.onLayoutDataChange(E);this.invalidate();}}else if(!(s instanceof sap.ui.layout.form.FormElement)){var p=s.getParent();if(p instanceof sap.ui.layout.form.FormElement){var o=p.getParent();var i=o.getId();if(this.mContainers[i]&&this.mContainers[i][1]){this.mContainers[i][1].onLayoutDataChange(E);}}}};b.prototype.onsapup=function(E){this.onsapleft(E);};b.prototype.onsapdown=function(E){this.onsapright(E);};b.prototype.getContainerRenderedDomRef=function(o){if(this.getDomRef()){var s=o.getId();if(this.mContainers[s]){if(this.mContainers[s][0]){var p=this.mContainers[s][0];return p.getDomRef();}else if(this.mContainers[s][1]){var i=this.mContainers[s][1];return i.getDomRef();}}}return null;};b.prototype.getElementRenderedDomRef=function(E){return null;};function _(o){var j=o.getFormContainers();var L=j.length;var v=0;var V=0;var n=[];var p;var r;var s;var t;var i=0;for(i=0;i<L;i++){s=j[i];s._checkProperties();if(s.isVisible()){v++;n.push(s);}}for(i=0;i<v;i++){s=n[i];if(s.isVisible()){V++;t=s.getId();p=undefined;r=undefined;var u=n[i+1];if(this.mContainers[t]&&this.mContainers[t][1]){r=this.mContainers[t][1];}else{r=e.call(this,s);}var T=s.getTitle();var w=s.getToolbar();if(w||T||s.getExpandable()){if(this.mContainers[t]&&this.mContainers[t][0]){p=this.mContainers[t][0];}else{p=c.call(this,s,r);g(r,true);}h(p,s,V,u,v);}else{if(this.mContainers[t]&&this.mContainers[t][0]){d(this.mContainers[t][0]);}g(r,false);h(r,s,V,u,v);}this.mContainers[t]=[p,r];}}var O=Object.keys(this.mContainers).length;if(v<O){for(t in this.mContainers){var x=false;for(i=0;i<L;i++){s=j[i];if(t==s.getId()&&s.isVisible()){x=true;break;}}if(!x){k.call(this,t);}}}}function c(o,i){var s=o.getId();var p=new P(s+"---Panel",{container:o,layout:this,content:i});return p;}function d(p){p.setContent("");p.setLayout("");p.setContainer("");p.destroy();}function e(o){var I=o.getId()+"--Grid";var n=new G(I,{vSpacing:0,hSpacing:0,containerQuery:true});n.__myParentLayout=this;n.__myParentContainerId=o.getId();n.addStyleClass("sapUiFormResGridCont");n.getContent=function(){var o=sap.ui.getCore().byId(this.__myParentContainerId);if(o){var r=[];var E=o.getFormElements();var s;var t;for(var i=0;i<E.length;i++){var u=E[i];if(u.isVisible()){t=u.getLabelControl();if(t){r.push(t);}s=u.getFields();for(var j=0;j<s.length;j++){r.push(s[j]);}}}return r;}else{return false;}};n.getAriaLabelledBy=function(){var o=sap.ui.getCore().byId(this.__myParentContainerId);if(o&&!o.getToolbar()&&!o.getTitle()&&!o.getExpandable()){return o.getAriaLabelledBy();}return[];};var B={labelSpan:0,span:0,firstField:false,defaultFields:0,row:0,myRow:false,freeFields:0,finished:false};var x={id:"XL",getEffectiveSpan:function(i){var s=i._getEffectiveSpanXLarge();if(!s){s=i._getEffectiveSpanLarge();}return s;},getEmptySpan:function(i){var E=i.getEmptySpanXL();if(E<0){E=i.getEmptySpanL();}return E;},getLabelSpan:function(i){return i.getLabelSpanXL();},setIndent:function(i,j){i.setIndentXL(j);},setLinebreak:function(i,j){i.setLinebreakXL(j);}};q.extend(x,B);var L={id:"L",getEffectiveSpan:function(i){return i._getEffectiveSpanLarge();},getEmptySpan:function(i){return i.getEmptySpanL();},getLabelSpan:function(i){return i.getLabelSpanL();},setIndent:function(i,j){i.setIndentL(j);},setLinebreak:function(i,j){i.setLinebreakL(j);}};q.extend(L,B);var M={id:"M",getEffectiveSpan:function(i){return i._getEffectiveSpanMedium();},getEmptySpan:function(i){return i.getEmptySpanM();},getLabelSpan:function(i){return i.getLabelSpanM();},setIndent:function(i,j){i.setIndentM(j);},setLinebreak:function(i,j){i.setLinebreakM(j);}};q.extend(M,B);var S={id:"S",getEffectiveSpan:function(i){return i._getEffectiveSpanSmall();},getEmptySpan:function(i){return i.getEmptySpanS();},getLabelSpan:function(i){return i.getLabelSpanS();},setIndent:function(i,j){i.setIndentS(j);},setLinebreak:function(i,j){i.setLinebreakS(j);}};q.extend(S,B);var p=[x,L,M,S];n._getLayoutDataForControl=function(j){var r=this.__myParentLayout;var t=r.getLayoutDataForElement(j,"sap.ui.layout.GridData");var E=j.getParent();var u=E.getLabelControl();if(t){if(u==j){t._setStylesInternal("sapUiFormElementLbl");}return t;}else{var o=sap.ui.getCore().byId(this.__myParentContainerId);var v=r.getLayoutDataForElement(o,"sap.ui.layout.GridData");var w=o.getParent();var y;var s=0;for(s=0;s<p.length;s++){y=p[s];q.extend(y,B);y.labelSpan=y.getLabelSpan(r);}if(r.getAdjustLabelSpan()){if(w.getFormContainers().length>=1&&r.getColumnsM()>1){M.labelSpan=r.getLabelSpanL();}if(v){if(v._getEffectiveSpanLarge()==12){L.labelSpan=r.getLabelSpanM();M.labelSpan=r.getLabelSpanM();}}if(w.getFormContainers().length==1||r.getColumnsL()==1){L.labelSpan=r.getLabelSpanM();M.labelSpan=r.getLabelSpanM();}}if(x.labelSpan<0){x.labelSpan=L.labelSpan;}if(u==j){r.oDummyLayoutData.setSpan("XL"+x.labelSpan+" L"+L.labelSpan+" M"+M.labelSpan+" S"+S.labelSpan);r.oDummyLayoutData.setLinebreak(true);r.oDummyLayoutData.setIndentXL(0).setIndentL(0).setIndentM(0).setIndentS(0);r.oDummyLayoutData._setStylesInternal("sapUiFormElementLbl");return r.oDummyLayoutData;}else{var z;if(u){z=r.getLayoutDataForElement(u,"sap.ui.layout.GridData");}var A=E.getFields();var D=A.length;var H;var J;var K=1;var N=false;var O;var i=0;for(s=0;s<p.length;s++){y=p[s];y.span=12-y.getEmptySpan(r);if(u){if(z){O=y.getEffectiveSpan(z);if(O){y.labelSpan=O;}}if(y.labelSpan<12){y.span=y.span-y.labelSpan;}}y.spanFields=y.span;}for(i=0;i<D;i++){H=A[i];if(H!=j){J=r.getLayoutDataForElement(H,"sap.ui.layout.GridData");if(J){for(s=0;s<p.length;s++){y=p[s];O=y.getEffectiveSpan(J);if(O&&O<y.span){y.span=y.span-O;}}}else{K++;}}else{if(K==1){N=true;}}}var Q=[];for(s=0;s<p.length;s++){y=p[s];y.firstField=N;y.defaultFields=K;if(y.span<K){y.defaultFields=0;y.row=0;y.myRow=false;y.freeFields=y.spanFields;y.span=y.spanFields;y.finished=false;Q.push(y);}}if(Q.length>0){for(i=0;i<D;i++){H=A[i];J=undefined;if(H!=j){J=r.getLayoutDataForElement(H,"sap.ui.layout.GridData");}for(s=0;s<Q.length;s++){y=Q[s];if(y.finished){continue;}if(J){O=y.getEffectiveSpan(J);y.span=y.span-O;}else{O=1;}if(y.freeFields>=O){y.freeFields=y.freeFields-O;if(!J){y.defaultFields++;}}else{if(y.myRow){y.finished=true;}else{y.freeFields=y.spanFields-O;y.row++;if(J){y.defaultFields=0;y.span=y.spanFields-O;}else{y.defaultFields=1;y.span=y.spanFields;}if(H==j){y.firstField=true;}}}if(H==j){y.myRow=true;}}}}var T=0;var U="";var V;for(s=0;s<p.length;s++){y=p[s];if(y.id!="S"||y.labelSpan<12){if(y.firstField){T=y.span-Math.floor(y.span/y.defaultFields)*y.defaultFields;V=Math.floor(y.span/y.defaultFields)+T;}else{V=Math.floor(y.span/y.defaultFields);}}else{V=12;}if(U){U=U+" ";}U=U+y.id+V;y.setLinebreak(r.oDummyLayoutData,y.firstField&&(y.row>0));y.setIndent(r.oDummyLayoutData,y.firstField&&(y.row>0)?y.labelSpan:0);}r.oDummyLayoutData.setSpan(U);r.oDummyLayoutData.setLinebreak(N&&!u);r.oDummyLayoutData._setStylesInternal(undefined);return r.oDummyLayoutData;}return t;}};n._onParentResizeOrig=n._onParentResize;n._onParentResize=function(){if(!this.getDomRef()){this._cleanup();return;}if(!q(this.getDomRef()).is(":visible")){return;}var j=this.__myParentLayout;if(!j._mainGrid||!j._mainGrid.__bIsUsed){var r=j.getParent().getFormContainers();var s;for(var i=0;i<r.length;i++){if(r[i].isVisible()){s=r[i];break;}}if(!s||!j.mContainers[s.getId()]||s.getId()!=this.__myParentContainerId){return;}if(j.mContainers[this.__myParentContainerId][0]){var D=j.mContainers[this.__myParentContainerId][0].getDomRef();var t=D.clientWidth;if(t<=j.getBreakpointM()){this._toggleClass("Phone");}else if((t>j.getBreakpointM())&&(t<=j.getBreakpointL())){this._toggleClass("Tablet");}else if((t>j.getBreakpointL())&&(t<=j.getBreakpointXL())){this._toggleClass("Desktop");}else{this._toggleClass("LargeDesktop");}}else{this._setBreakPointTablet(j.getBreakpointM());this._setBreakPointDesktop(j.getBreakpointL());this._setBreakPointLargeDesktop(j.getBreakpointXL());this._onParentResizeOrig();}}else{var $=j._mainGrid.$();if($.hasClass("sapUiRespGridMedia-Std-Phone")){this._toggleClass("Phone");}else if($.hasClass("sapUiRespGridMedia-Std-Tablet")){this._toggleClass("Tablet");}else if($.hasClass("sapUiRespGridMedia-Std-Desktop")){this._toggleClass("Desktop");}else{this._toggleClass("LargeDesktop");}}};n._getAccessibleRole=function(){var o=sap.ui.getCore().byId(this.__myParentContainerId);var i=this.__myParentLayout;if(i._mainGrid&&i._mainGrid.__bIsUsed&&!o.getToolbar()&&!o.getTitle()&&!o.getExpandable()&&o.getAriaLabelledBy().length>0){return"form";}};n.getUIArea=function(){var i=this.__myParentLayout;if(i){return i.getUIArea();}else{return null;}};return n;}function f(o){if(o.__myParentContainerId){o.__myParentContainerId=undefined;}o.__myParentLayout=undefined;o.destroy();}function g(o,O){if(O){if(o.__originalGetLayoutData){o.getLayoutData=o.__originalGetLayoutData;delete o.__originalGetLayoutData;}}else if(!o.__originalGetLayoutData){o.__originalGetLayoutData=o.getLayoutData;o.getLayoutData=function(){var L=this.__myParentLayout;var i=sap.ui.getCore().byId(this.__myParentContainerId);var j;if(i){j=L.getLayoutDataForElement(i,"sap.ui.layout.GridData");}if(j){return j;}else{return this.getAggregation("layoutData");}};}}function h(o,i,v,j,V){var L;if(o instanceof sap.ui.layout.form.ResponsiveGridLayoutPanel){L=sap.ui.getCore().byId(o.getLayout());}else{L=o.__myParentLayout;}var n=L.getLayoutDataForElement(i,"sap.ui.layout.GridData");if(!n){var p=L.getColumnsM();var r=L.getColumnsL();var s=L.getColumnsXL();var t=(v%r)==1;var u=(v%r)==0;var w=v>(r*(Math.ceil(V/r)-1));var x=v<=r;var y=(v%p)==1;var z=(v%p)==0;var A=v>(p*(Math.ceil(V/p)-1));var B=v<=p;var D=false;var E=u;var H=w;var I=x;if(s>0){D=(v%s)==1;E=(v%s)==0;H=v>(s*(Math.ceil(V/s)-1));I=v<=s;}if(j){var J=L.getLayoutDataForElement(j,"sap.ui.layout.GridData");if(J&&(J.getLinebreak()||J.getLinebreakXL())){E=true;H=false;}if(J&&(J.getLinebreak()||J.getLinebreakL())){u=true;w=false;}if(J&&(J.getLinebreak()||J.getLinebreakM())){z=true;A=false;}}var S="";if(E){S="sapUiFormResGridLastContXL";}if(u){if(S){S=S+" ";}S=S+"sapUiFormResGridLastContL";}if(z){if(S){S=S+" ";}S=S+"sapUiFormResGridLastContM";}if(H){if(S){S=S+" ";}S=S+"sapUiFormResGridLastRowXL";}if(w){if(S){S=S+" ";}S=S+"sapUiFormResGridLastRowL";}if(A){if(S){S=S+" ";}S=S+"sapUiFormResGridLastRowM";}if(I){if(S){S=S+" ";}S=S+"sapUiFormResGridFirstRowXL";}if(x){if(S){S=S+" ";}S=S+"sapUiFormResGridFirstRowL";}if(B){if(S){S=S+" ";}S=S+"sapUiFormResGridFirstRowM";}n=o.getLayoutData();if(!n){n=new a(o.getId()+"--LD",{linebreakL:t,linebreakM:y});o.setLayoutData(n);}else{n.setLinebreakL(t);n.setLinebreakM(y);}if(s>0){n.setLinebreakXL(D);}n._setStylesInternal(S);}}function k(s){var i=this.mContainers[s];var o=i[1];if(o){f(o);}var p=i[0];if(p){d(p);}delete this.mContainers[s];}function m(o){var n=o.getFormContainers();var v=[];var p;var L=0;var r=0;var i=0;var j=0;for(i=0;i<n.length;i++){p=n[i];if(p.isVisible()){L++;v.push(p);}}if(L>1||!this.getSingleContainerFullSize()){var s=Math.floor(12/this.getColumnsM());var S=Math.floor(12/this.getColumnsL());var t;var D="";var u=this.getColumnsXL();if(u>=0){t=Math.floor(12/u);D=D+"XL"+t+" ";}D=D+"L"+S+" M"+s+" S12";if(!this._mainGrid){this._mainGrid=new G(o.getId()+"--Grid",{defaultSpan:D,hSpacing:0,vSpacing:0,containerQuery:true}).setParent(this);this._mainGrid.addStyleClass("sapUiFormResGridMain");this._mainGrid._onParentResizeOrig=this._mainGrid._onParentResize;this._mainGrid._onParentResize=function(){this._onParentResizeOrig();var B=this.getParent();for(var A in B.mContainers){B.mContainers[A][1]._onParentResize();}};}else{this._mainGrid.setDefaultSpan(D);var w=this._mainGrid.getContent();r=w.length;var E=false;for(i=0;i<r;i++){var x=w[i];p=undefined;if(x.getContainer){p=sap.ui.getCore().byId(x.getContainer());}else{p=sap.ui.getCore().byId(x.__myParentContainerId);}if(p&&p.isVisible()){var V=v[j];if(p!=V){E=true;break;}var y=this.mContainers[p.getId()];if(y[0]&&y[0]!=x){E=true;break;}if(!y[0]&&y[1]&&y[1]!=x){E=true;break;}j++;}else{this._mainGrid.removeContent(x);}}if(E){this._mainGrid.removeAllContent();r=0;}}this._mainGrid._setBreakPointTablet(this.getBreakpointM());this._mainGrid._setBreakPointDesktop(this.getBreakpointL());this._mainGrid._setBreakPointLargeDesktop(this.getBreakpointXL());this._mainGrid.__bIsUsed=true;if(r<L){var z=0;if(r>0){z=r--;}for(i=z;i<n.length;i++){p=n[i];if(p.isVisible()){var A=p.getId();if(this.mContainers[A]){if(this.mContainers[A][0]){this._mainGrid.addContent(this.mContainers[A][0]);}else if(this.mContainers[A][1]){this._mainGrid.addContent(this.mContainers[A][1]);}}}}}}else if(this._mainGrid){this._mainGrid.__bIsUsed=false;}}return b;});
