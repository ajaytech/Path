/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define([],function(){"use strict";var d="[=(),; \"']|%(20|22|27|28|29|2c|2C|3b|3B)",s="\\$\\w+",o="[a-zA-Z_\\u0080-\\uFFFF][\\w\\u0080-\\uFFFF]*",r="(?:[ \\t]|%09|%20)",a=new RegExp(r+"+","g"),O="("+r+"+)(eq|ge|gt|le|lt|ne)"+r+"*",S="(?:\\*|%2[aA])",n=o+"(?:[./]"+o+")*"+"(?:[./]"+S+"|/\\$ref|/\\$count)?",b=S+"(?:/\\$ref)?",p=n+"|"+b,v='(?:[-+:./\\w"]|%2[bB])+',e=new RegExp("^(?:"+O+"|"+d+"|("+p+")|("+v+")|("+s+"))"),f=/^[0-9a-f]{2}$/i;function P(){}P.prototype.advance=function(E){var T=this.aTokens[this.iCurrentToken];if(E&&(!T||T.id!==E)){if(E==="OPTION"){E="system query option";}else if(E.length===1){E="'"+E+"'";}this.expected(E,T);}this.iCurrentToken+=1;return T;};P.prototype.advanceIf=function(E){var T=this.aTokens[this.iCurrentToken];if(T&&T.id===E){this.iCurrentToken+=1;return true;}return false;};P.prototype.current=function(){return this.aTokens[this.iCurrentToken];};P.prototype.expected=function(w,T){var m="Expected "+w+" but instead saw ",v;if(T){v=T.value;m+="'"+(v===" "?v:v.replace(a,""))+"' at "+T.at;}else{m+="end of input";}throw new SyntaxError(m+": "+this.sText);};P.prototype.finish=function(R){if(this.iCurrentToken<this.aTokens.length){this.expected("end of input",this.aTokens[this.iCurrentToken]);}return R;};P.prototype.init=function(T){this.sText=T;this.aTokens=j(T);this.iCurrentToken=0;};function F(){}F.prototype=Object.create(P.prototype);F.prototype.parse=function(c){var i,k,V;this.init(c);k=this.advance("PATH");i=this.advance();switch(i&&i.id){case"eq":case"ge":case"gt":case"le":case"lt":case"ne":break;default:this.expected("operator",i);}V=this.advance("VALUE");i.left=k;i.right=V;return i;};function g(){}g.prototype=Object.create(P.prototype);g.prototype.parse=function(c){this.init(c);return this.finish(this.parseSystemQueryOption());};g.prototype.parseAnythingWithBrackets=function(c){var v="",R={},T,i=this;function k(){for(;;){T=i.advance();if(!T||T.id===';'){i.expected("')'",T);}v+=T.value;if(T.id===")"){return;}if(T.id==="("){k();}}}this.advance("=");for(;;){T=this.current();if(!T||T.id===")"||T.id===";"){break;}v+=this.advance().value;if(T.id==="("){k();}}if(!v){this.expected("an option value",T);}R[c.value]=v;return R;};g.prototype.parseExpand=function(){var E={},c,q,Q,V;this.advance("=");do{V=null;c=this.advance("PATH").value.replace(/%2a/i,"*");if(this.advanceIf("(")){V={};do{q=this.parseSystemQueryOption();Q=Object.keys(q)[0];V[Q]=q[Q];}while(this.advanceIf(";"));this.advance(")");}E[c]=V;}while(this.advanceIf(","));return{"$expand":E};};g.prototype.parseSelect=function(){var p,c,i=[],T;this.advance("=");do{T=this.advance("PATH");p=T.value.replace(/%2a/i,"*");if(this.advanceIf("(")){c="(";do{p+=c+this.advance("PATH").value;c=",";}while(this.advanceIf(","));p+=this.advance(")").value;}i.push(p);}while(this.advanceIf(","));return{"$select":i};};g.prototype.parseSystemQueryOption=function(){var T=this.advance('OPTION');switch(T.value){case"$expand":return this.parseExpand();case"$select":return this.parseSelect();default:return this.parseAnythingWithBrackets(T);}};function u(E){return String.fromCharCode(parseInt(E,16));}function t(N,k,A){var i;function l(C){var c=N[i];if(C){i+=1;}if(c==="%"&&N[i]==="2"&&N[i+1]==="7"){c="'";if(C){i+=2;}}return c;}for(i=1;i<N.length;){if(l(true)==="'"){if(l(false)!=="'"){return N.slice(0,i);}l(true);}}throw new SyntaxError("Unterminated string at "+A+": "+k);}function h(N,k,A){var c,E,l=false,i;for(i=1;i<N.length;i+=1){if(l){l=false;}else{c=N[i];if(c==="%"){E=N.slice(i+1,i+3);if(f.test(E)){c=u(E);i+=2;}}if(c==='"'){return N.slice(0,i+1);}l=c==='\\';}}throw new SyntaxError("Unterminated string at "+A+": "+k);}function j(c){var A=1,i,m,N=c,k,T,l=[],v;while(N.length){m=e.exec(N);k=0;if(m){v=m[0];if(m[6]){i="OPTION";}else if(m[5]){i="VALUE";}else if(m[4]){i="PATH";if(v==="false"||v==="true"||v==="null"){i="VALUE";}}else if(m[3]){i=u(m[3]);}else if(m[2]){i=m[2];k=m[1].length;}else{i=m[0];}if(i==='"'){i="VALUE";v=h(N,c,A);}else if(i==="'"){i="VALUE";v=t(N,c,A);}T={at:A+k,id:i,value:v};}else{throw new SyntaxError("Unknown character '"+N[0]+"' at "+A+": "+c);}N=N.slice(v.length);A+=v.length;l.push(T);}return l;}return{buildFilterString:function(c){return c.left.value+c.value+c.right.value;},parseFilter:function(c){return new F().parse(c);},parseSystemQueryOption:function(c){return new g().parse(c);}};},false);
