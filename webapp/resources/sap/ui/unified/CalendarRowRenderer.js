/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/core/date/UniversalDate','sap/ui/unified/CalendarAppointment','sap/ui/unified/CalendarRow','sap/ui/unified/CalendarLegend','sap/ui/Device','sap/ui/unified/library'],function(q,U,C,a,b,D,l){"use strict";var c=l.CalendarDayType;var d=l.CalendarIntervalType;var e=l.CalendarAppointmentVisualization;var f={};f.render=function(r,R){var t=R.getTooltip_AsString();var v=R.getAppointmentsVisualization();var T=this.getLegendItems(R);r.write("<div");r.writeControlData(R);r.addClass("sapUiCalendarRow");if(!D.system.phone&&R.getAppointmentsReducedHeight()){r.addClass("sapUiCalendarRowAppsRedHeight");}if(v!=e.Standard){r.addClass("sapUiCalendarRowVis"+v);}if(R._sFocusedAppointmentId){r.writeAttribute("tabindex","-1");}else{r.writeAttribute("tabindex","0");}if(t){r.writeAttributeEscaped("title",t);}var w=R.getWidth();if(w){r.addStyle("width",w);}var h=R.getHeight();if(h){r.addStyle("height",h);}r.writeAccessibilityState(R);r.writeClasses();r.writeStyles();r.write(">");this.renderAppointmentsRow(r,R,T);r.write("</div>");};f.renderAppointmentsRow=function(r,R,t){var i=R.getId();r.write("<div id=\""+i+"-Apps\" class=\"sapUiCalendarRowApps\">");this.renderAppointments(r,R,t);r.write("</div>");};f.renderAppointments=function(r,R,t){var A=R._getVisibleAppointments();var I=R._getVisibleIntervalHeaders();var s=R._getStartDate();var n=[];var N=[];var S=0;var g=0;var h=[];var j=0;var k=0;var m=R.getIntervals();var o=R.getIntervalType();var w=100/m;var i=0;var p=new U(s);var F=false;var L=false;switch(o){case d.Hour:n=R.getNonWorkingHours()||[];S=s.getUTCHours();g=24;break;case d.Day:case d.Week:case d.OneMonth:n=R._getNonWorkingDays();N=R.getAggregation("_nonWorkingDates");S=s.getUTCDay();g=7;h=R.getNonWorkingHours()||[];j=s.getUTCHours();k=24;break;case d.Month:h=R._getNonWorkingDays();j=s.getUTCDay();k=7;break;default:break;}if(R._isOneMonthIntervalOnSmallSizes()){this.renderSingleDayInterval(r,R,A,t,I,n,S,g,h,j,k,true,true);}else{for(i=0;i<m;i++){if(L){F=true;}else{F=false;}L=false;switch(o){case d.Hour:p.setUTCHours(p.getUTCHours()+1);if(p.getUTCHours()==0){L=true;}break;case d.Day:case d.Week:case d.OneMonth:p.setUTCDate(p.getUTCDate()+1);if(p.getUTCDate()==1){L=true;}break;case d.Month:p.setUTCMonth(p.getUTCMonth()+1);if(p.getUTCMonth()==0){L=true;}break;default:break;}this.renderInterval(r,R,i,w,I,n,N,S,g,h,j,k,F,L);}this.renderIntervalHeaders(r,R,w,I,m);r.write("<div id=\""+R.getId()+"-Now\" class=\"sapUiCalendarRowNow\"></div>");for(i=0;i<A.length;i++){var u=A[i];this.renderAppointment(r,R,u,t);}r.write("<div id=\""+R.getId()+"-DummyApp\" class=\"sapUiCalendarApp sapUiCalendarAppTitleOnly sapUiCalendarAppDummy\"></div>");}};f.renderInterval=function(r,R,I,w,g,n,N,s,h,k,S,m,F,L){var o=R.getId()+"-AppsInt"+I;var i;var p=R.getShowIntervalHeaders()&&(R.getShowEmptyIntervalHeaders()||g.length>0);var M=R.getStartDate().getMonth();var t=new Date(R.getStartDate().getFullYear(),M+1,0).getDate();var u=R.getStartDate();var v;var x;var y;r.write("<div id=\""+o+"\"");r.addClass("sapUiCalendarRowAppsInt");r.addStyle("width",w+"%");if(I>=t&&R.getIntervalType()===d.OneMonth){r.addClass("sapUiCalItemOtherMonth");}for(i=0;i<n.length;i++){if((I+s)%h==n[i]){r.addClass("sapUiCalendarRowAppsNoWork");break;}}if(N&&N.length){v=new Date(u.getTime());v.setHours(0,0,0);v.setDate(u.getDate()+I);var z=function(K){return K===v.getDay();};for(i=0;i<N.length;i++){if(N[i].getStartDate()){x=new Date(N[i].getStartDate().getTime());}if(N[i].getEndDate()){y=new Date(N[i].getEndDate().getTime());}else{y=new Date(N[i].getStartDate().getTime());y.setHours(23,59,59);}if(v.getTime()>=x.getTime()&&v.getTime()<=y.getTime()){var A=n.some(z);if(!A){r.addClass("sapUiCalendarRowAppsNoWork");}}}}if(!p){r.addClass("sapUiCalendarRowAppsIntNoHead");}if(F){r.addClass("sapUiCalendarRowAppsIntFirst");}if(L){r.addClass("sapUiCalendarRowAppsIntLast");}r.writeClasses();r.writeStyles();r.write(">");if(p){r.write("<div");r.addClass("sapUiCalendarRowAppsIntHead");r.writeClasses();r.write(">");r.write("</div>");}if(R.getShowSubIntervals()){var B=R.getIntervalType();var E=0;switch(B){case d.Hour:E=4;break;case d.Day:case d.Week:case d.OneMonth:E=24;break;case d.Month:var G=R._getStartDate();var H=new U(G);H.setUTCMonth(H.getUTCMonth()+I+1,0);E=H.getUTCDate();H.setUTCDate(1);s=H.getUTCDay();break;default:break;}var J=100/E;for(i=0;i<E;i++){r.write("<div");r.addClass("sapUiCalendarRowAppsSubInt");r.addStyle("width",J+"%");for(var j=0;j<k.length;j++){if((i+S)%m==k[j]){r.addClass("sapUiCalendarRowAppsNoWork");break;}}r.writeStyles();r.writeClasses();r.write(">");r.write("</div>");}}r.write("</div>");};f.renderIntervalHeaders=function(r,R,w,I,g){var s=R.getShowIntervalHeaders()&&(R.getShowEmptyIntervalHeaders()||I.length>0);if(s){for(var i=0;i<I.length;i++){var o=I[i],L,h;if(R._bRTL){h=w*o.interval;L=w*(g-o.last-1);}else{L=w*o.interval;h=w*(g-o.last-1);}this.renderIntervalHeader(r,o,R._bRTL,L,h);}}};f.renderIntervalHeader=function(r,i,R,g,h){var I=i.appointment.getId();r.write("<div");r.addClass("sapUiCalendarRowAppsIntHead");if(g!==undefined){r.addStyle("left",g+"%");}if(h!==undefined){r.addStyle("right",h+"%");}r.writeElementData(i.appointment);r.addClass("sapUiCalendarRowAppsIntHeadFirst");if(i.appointment.getSelected()){r.addClass("sapUiCalendarRowAppsIntHeadSel");}if(i.appointment.getTentative()){r.addClass("sapUiCalendarRowAppsIntHeadTent");}var t=i.appointment.getTooltip_AsString();if(t){r.writeAttributeEscaped("title",t);}var T=i.appointment.getType();var s=i.appointment.getColor();if(!s&&T&&T!=c.None){r.addClass("sapUiCalendarRowAppsIntHead"+T);}if(s){if(R){r.addStyle("border-right-color",s);}else{r.addStyle("border-left-color",s);}}r.writeStyles();r.writeClasses();r.write(">");r.write("<div");r.addClass("sapUiCalendarIntervalHeaderCont");r.writeClasses();if(s){r.addStyle("background-color",i.appointment._getCSSColorForBackground(s));r.writeStyles();}r.write(">");var j=i.appointment.getIcon();if(j){var k=["sapUiCalendarRowAppsIntHeadIcon"];var A={};A["id"]=I+"-Icon";A["title"]=null;r.writeIcon(j,k,A);}var m=i.appointment.getTitle();if(m){r.write("<span");r.writeAttribute("id",I+"-Title");r.addClass("sapUiCalendarRowAppsIntHeadTitle");r.writeClasses();r.write(">");r.writeEscaped(m,true);r.write("</span>");}var n=i.appointment.getText();if(n){r.write("<span");r.writeAttribute("id",I+"-Text");r.addClass("sapUiCalendarRowAppsIntHeadText");r.writeClasses();r.write(">");r.writeEscaped(n,true);r.write("</span>");}r.write("</div>");r.write("</div>");};f.renderAppointment=function(r,R,A,t,g){var o=A.appointment;var T=o.getTooltip_AsString();var s=o.getType();var h=o.getColor();var i=o.getTitle();var j=o.getText();var I=o.getIcon();var k=o.getId();var m={labelledby:{value:a._oStaticAppointmentText.getId()+" "+k+"-Descr",append:true}};var n=R.getAriaLabelledBy();if(n.length>0){m["labelledby"].value=m["labelledby"].value+" "+n.join(" ");}if(i){m["labelledby"].value=m["labelledby"].value+" "+k+"-Title";}if(j){m["labelledby"].value=m["labelledby"].value+" "+k+"-Text";}r.write("<div");r.writeElementData(o);r.addClass("sapUiCalendarApp");if(o.getSelected()){r.addClass("sapUiCalendarAppSel");m["labelledby"].value=m["labelledby"].value+" "+a._oStaticSelectedText.getId();}if(o.getTentative()){r.addClass("sapUiCalendarAppTent");m["labelledby"].value=m["labelledby"].value+" "+a._oStaticTentativeText.getId();}if(!j){r.addClass("sapUiCalendarAppTitleOnly");}if(I){r.addClass("sapUiCalendarAppWithIcon");}if(!g){if(R._bRTL){r.addStyle("right",A.begin+"%");r.addStyle("left",A.end+"%");}else{r.addStyle("left",A.begin+"%");r.addStyle("right",A.end+"%");}}r.writeAttribute("data-sap-level",A.level);if(R._sFocusedAppointmentId==k){r.writeAttribute("tabindex","0");}else{r.writeAttribute("tabindex","-1");}if(T){r.writeAttributeEscaped("title",T);}if(!h&&s&&s!=c.None){r.addClass("sapUiCalendarApp"+s);}if(h){if(R._bRTL){r.addStyle("border-right-color",h);}else{r.addStyle("border-left-color",h);}}r.writeAccessibilityState(o,m);r.writeClasses();r.writeStyles();r.write(">");r.write("<div");r.addClass("sapUiCalendarAppCont");if(h&&R.getAppointmentsVisualization()===e.Filled){r.addStyle("background-color",o._getCSSColorForBackground(h));r.writeStyles();}r.writeClasses();r.write(">");if(I){var p=["sapUiCalendarAppIcon"];var u={};u["id"]=k+"-Icon";u["title"]=null;r.writeIcon(I,p,u);}if(i){r.write("<span");r.writeAttribute("id",k+"-Title");r.addClass("sapUiCalendarAppTitle");r.writeClasses();r.write(">");r.writeEscaped(i,true);r.write("</span>");}if(j){r.write("<span");r.writeAttribute("id",k+"-Text");r.addClass("sapUiCalendarAppText");r.writeClasses();r.write(">");r.writeEscaped(j,true);r.write("</span>");}var v=R._oRb.getText("CALENDAR_START_TIME")+": "+R._oFormatAria.format(o.getStartDate());v=v+"; "+R._oRb.getText("CALENDAR_END_TIME")+": "+R._oFormatAria.format(o.getEndDate());if(T){v=v+"; "+T;}if(s&&s!=c.None){v=v+"; "+this.getAriaTextForType(s,t);}r.write("<span id=\""+k+"-Descr\" class=\"sapUiInvisibleText\">"+v+"</span>");r.write("</div>");r.write("</div>");};f.renderSingleDayInterval=function(r,R,A,t,I,n,s,N,g,S,h,F,L){var k=1,w=100,m=R.getId()+"-AppsInt"+k,i,o=R.getShowIntervalHeaders()&&(R.getShowEmptyIntervalHeaders()||I.length>0),p=R.getStartDate(),M=p.getMonth(),u=new Date(p.getFullYear(),M+1,0).getDate(),v,x=A.concat(R.getIntervalHeaders().filter(function(H){var J=H.getStartDate().getTime(),K=H.getStartDate().getTime(),O=p.getTime(),P=O+1000*60*60*24;return(J>=O&&J<P)||(K>=O&&K<P);}).map(function(H){return{appointment:H,isHeader:true};})).sort(C._getComparer(p)),y;r.write("<div id=\""+m+"\"");r.addClass("sapUiCalendarRowAppsInt");r.addClass("sapUiCalendarMonthRowAppsS");r.addStyle("width",w+"%");if(k>=u&&R.getIntervalType()===d.OneMonth){r.addClass("sapUiCalItemOtherMonth");}for(i=0;i<n.length;i++){if((k+s)%N==n[i]){r.addClass("sapUiCalendarRowAppsNoWork");break;}}if(!o){r.addClass("sapUiCalendarRowAppsIntNoHead");}if(F){r.addClass("sapUiCalendarRowAppsIntFirst");}if(L){r.addClass("sapUiCalendarRowAppsIntLast");}r.writeClasses();r.writeStyles();r.write(">");if(o){r.write("<div");r.addClass("sapUiCalendarRowAppsIntHead");r.writeClasses();r.write(">");r.write("</div>");}for(i=0;i<x.length;i++){y=x[i];r.write("<div class=\"sapUiCalendarAppContainer\">");r.write("<div class=\"sapUiCalendarAppContainerLeft\">");r.write("<div>"+y.appointment._getDateRangeIntersectionText(p)+"</div>");r.write("</div>");r.write("<div class=\"sapUiCalendarAppContainerRight\">");if(y.isHeader){this.renderIntervalHeader(r,y);}else{this.renderAppointment(r,R,y,t,true);}r.write("</div>");r.write("</div>");}if(A.length===0){r.write("<div class=\"sapUiCalendarNoApps\">");v=sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("PLANNINGCALENDAR_ROW_NO_APPOINTMENTS");r.write(v);r.write("</div>");}r.write("<div id=\""+R.getId()+"-Now\" class=\"sapUiCalendarRowNow\"></div>");r.write("<div id=\""+R.getId()+"-DummyApp\" class=\"sapUiCalendarApp sapUiCalendarAppTitleOnly sapUiCalendarAppDummy\" style='margin:0; height:0px;'></div>");if(R.getShowSubIntervals()){var z=R.getIntervalType();var B=0;switch(z){case d.Hour:B=4;break;case d.Day:case d.Week:case d.OneMonth:B=24;break;case d.Month:var E=new U(p);E.setUTCMonth(E.getUTCMonth()+k+1,0);B=E.getUTCDate();E.setUTCDate(1);s=E.getUTCDay();break;default:break;}var G=100/B;for(i=0;i<B;i++){r.write("<div");r.addClass("sapUiCalendarRowAppsSubInt");r.addStyle("width",G+"%");for(var j=0;j<g.length;j++){if((i+S)%h==g[j]){r.addClass("sapUiCalendarRowAppsNoWork");break;}}r.writeStyles();r.writeClasses();r.write(">");r.write("</div>");}}r.write("</div>");};f.getLegendItems=function(o){var r=[],L,s=o.getLegend();if(s){L=sap.ui.getCore().byId(s);if(L){r=L.getItems();}else{q.sap.log.error("CalendarLegend with id '"+s+"' does not exist!",o);}}return r;};f.getAriaTextForType=function(t,L){var T,s,I,i;if(L&&L.length){for(var i=0;i<L.length;i++){I=L[i];if(I.getType()===t){T=I.getText();break;}}}if(!T){s=b.getTypeAriaText(t);if(s){T=s.getText();}}return T;};return f;},true);
