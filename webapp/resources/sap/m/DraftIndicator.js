/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/m/Label","sap/m/library","jquery.sap.global"],function(C,L,l,q){"use strict";var D=l.DraftIndicatorState;var a=C.extend("sap.m.DraftIndicator",{metadata:{properties:{state:{type:"sap.m.DraftIndicatorState",group:"Behavior",defaultValue:D.Clear},minDisplayTime:{type:"int",group:"Behavior",defaultValue:1500}},aggregations:{_label:{type:"sap.m.Label",multiple:false,visibility:"hidden"}}}});var b=sap.ui.getCore().getLibraryResourceBundle("sap.m");a._oTEXTS={};a._oTEXTS[D.Saving]=b.getText("DRAFT_INDICATOR_SAVING_DRAFT");a._oTEXTS[D.Saved]=b.getText("DRAFT_INDICATOR_DRAFT_SAVED");a._oTEXTS[D.Clear]="";a.prototype.init=function(){this.aQueue=[];this.iDelayedCallId=null;};a.prototype.exit=function(){this._resetDraftTimer();};a.prototype.setState=function(s){this.setProperty("state",s);this._addToQueue(s);if(s===D.Saving){this._addToQueue(D.Clear);}return this;};a.prototype._getLabel=function(){var c=this.getAggregation('_label');if(!c){var c=new L({id:this.getId()+"-label"});this.setAggregation('_label',c,true);c=this.getAggregation('_label');}return c;};a.prototype.showDraftSaving=function(){this._addToQueue(D.Saving);this._addToQueue(D.Clear);};a.prototype.showDraftSaved=function(){this._addToQueue(D.Saved);};a.prototype.clearDraftState=function(){this._addToQueue(D.Clear);};a.prototype._addToQueue=function(s){this.aQueue.push(s);this._processQueue();};a.prototype._processQueue=function(){if(this.iDelayedCallId){return;}var n=this.aQueue.shift();var t=this.getMinDisplayTime();if(!n){return;}this._applyState(n);if(n===D.Clear){this._proceed();return;}this.iDelayedCallId=q.sap.delayedCall(t,this,this._proceed);};a.prototype._proceed=function(){this._resetDraftTimer();this._processQueue();};a.prototype._applyState=function(s){this._getLabel().setText(a._oTEXTS[s]);};a.prototype._resetDraftTimer=function(){q.sap.clearDelayedCall(this.iDelayedCallId);this.iDelayedCallId=null;};return a;});
